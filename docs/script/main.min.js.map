{"version":3,"file":"main.min.js","mappings":"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","sources":["webpack://flowers-webgl/./src/ts/corolla.ts","webpack://flowers-webgl/./src/ts/flower.ts","webpack://flowers-webgl/./src/ts/flowers-manager.ts","webpack://flowers-webgl/./src/ts/force-field.ts","webpack://flowers-webgl/./src/ts/gl-utils/gl-canvas.ts","webpack://flowers-webgl/./src/ts/gl-utils/gl-resource.ts","webpack://flowers-webgl/./src/ts/gl-utils/shader-manager.ts","webpack://flowers-webgl/./src/ts/gl-utils/shader-sources.ts","webpack://flowers-webgl/./src/ts/gl-utils/shader.ts","webpack://flowers-webgl/./src/ts/helpers.ts","webpack://flowers-webgl/./src/ts/noise.ts","webpack://flowers-webgl/./src/ts/parameters.ts","webpack://flowers-webgl/./src/ts/plotting/color.ts","webpack://flowers-webgl/./src/ts/plotting/plotter-canvas-2d.ts","webpack://flowers-webgl/./src/ts/plotting/plotter-canvas-base.ts","webpack://flowers-webgl/./src/ts/plotting/plotter-canvas-webgl.ts","webpack://flowers-webgl/./src/ts/plotting/plotter-svg.ts","webpack://flowers-webgl/./src/ts/plotting/plotter.ts","webpack://flowers-webgl/./src/ts/rope.ts","webpack://flowers-webgl/webpack/bootstrap","webpack://flowers-webgl/./src/ts/main.ts"],"sourcesContent":["import { ForceField } from \"./force-field\";\r\nimport { IEllipse, IPoint, IVector } from \"./interfaces\";\r\nimport { Noise } from \"./noise\";\r\nimport { Parameters } from \"./parameters\";\r\nimport { Color } from \"./plotting/color\";\r\nimport { Plotter } from \"./plotting/plotter\";\r\n\r\n\r\ninterface IPetal extends IEllipse {\r\n    petalArea: number;\r\n    rotationSpeed: number;\r\n}\r\n\r\nfunction randomColor(): Color {\r\n    const random = Noise.randomInRange(0, 3);\r\n    const randomChannel = Math.floor(0.5 * 255 * (random % 1));\r\n\r\n    if (random < 1) {\r\n        return new Color(255, 0, 255 - randomChannel);\r\n    } else if (random < 2) {\r\n        return new Color(255, randomChannel, 0);\r\n    } else if (random < 3) {\r\n        return new Color(255 - randomChannel, 255, 0);\r\n    } else if (random < 4) {\r\n        return new Color(0, 255, randomChannel);\r\n    } else if (random < 5) {\r\n        return new Color(0, 255 - randomChannel, 255);\r\n    } else {\r\n        return new Color(randomChannel, 0, 255);\r\n    }\r\n}\r\n\r\nclass Corolla {\r\n    public readonly position: IPoint; // readonly because attachedPetals reference it\r\n\r\n    private readonly color: Color;\r\n    private readonly initialPetalsCount: number;\r\n    private readonly attachedPetals: IPetal[];\r\n    private readonly floatingPetals: IPetal[];\r\n    private readonly outline: IPoint[];\r\n\r\n    private readonly noise: Noise;\r\n\r\n    private readonly maxLiftingForce: number;\r\n\r\n    private wind: IVector;\r\n\r\n    public constructor() {\r\n        this.position = { x: 0, y: 0 };\r\n        this.color = randomColor();\r\n        this.initialPetalsCount = Parameters.petalsCount;\r\n        this.attachedPetals = this.computePetals(this.initialPetalsCount);\r\n        this.floatingPetals = [];\r\n        this.outline = Corolla.computeOutline(40, 20);\r\n\r\n        this.noise = new Noise(Noise.randomInRange(1, 2));\r\n        this.maxLiftingForce = Noise.randomInRange(5000, 8000);\r\n    }\r\n\r\n    public update(dt: number): void {\r\n        if (this.attachedPetals.length > 0 && Math.random() < this.petalsDropRate * dt) {\r\n            const detachedPetal = this.attachedPetals.pop();\r\n            detachedPetal.center = { x: this.position.x, y: this.position.y };\r\n            detachedPetal.rotationSpeed = Noise.randomInRange(-1.5, 1.5);\r\n            this.floatingPetals.push(detachedPetal);\r\n        }\r\n\r\n        for (const detachedPetal of this.floatingPetals) {\r\n            detachedPetal.center.y -= 0.05 * detachedPetal.petalArea * dt;\r\n            detachedPetal.orientation += detachedPetal.rotationSpeed * dt;\r\n        }\r\n        this.trimFloatingPetals();\r\n\r\n        this.wind = this.noise.compute(dt);\r\n        this.wind.x = Parameters.wind * 10000 * (this.wind.x - 0.5);\r\n        this.wind.y = 1000 * (this.wind.y - 0.5);\r\n    }\r\n\r\n    public draw(plotter: Plotter): void {\r\n        this.drawOutline(plotter);\r\n        this.drawPetals(plotter);\r\n    }\r\n\r\n    public getAcceleration(forceField: ForceField): IVector {\r\n        let strength = 0.75;\r\n        if (this.initialPetalsCount > 0) {\r\n            strength = Math.pow(this.attachedPetals.length / this.initialPetalsCount, 0.25);\r\n        }\r\n\r\n        const acceleration: IVector = { x: 0, y: 0 };\r\n        acceleration.x += this.wind.x * strength;\r\n        acceleration.y += this.wind.y;\r\n\r\n        const GRAVITY = 3000;\r\n        acceleration.y += GRAVITY - this.maxLiftingForce * strength;\r\n\r\n        const fieldForce = forceField.computeForce(this.position);\r\n        acceleration.x += strength * 2000 * fieldForce.x;\r\n        acceleration.y += strength * 2000 * fieldForce.y;\r\n\r\n        return acceleration;\r\n    }\r\n\r\n    public isDead(lowestAllowed: number): boolean {\r\n        if (Parameters.petalsCount > 0) {\r\n            return this.attachedPetals.length <= 0 && this.floatingPetals.length <= 0 && this.position.y > lowestAllowed + 50;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private drawPetals(plotter: Plotter): void {\r\n        const allPetals = this.attachedPetals.concat(this.floatingPetals);\r\n        const color = Parameters.singlePetalColor ? Parameters.petalColor : this.color;\r\n        plotter.drawEllipses(allPetals, color);\r\n    }\r\n\r\n    private drawOutline(plotter: Plotter): void {\r\n        plotter.drawPolygon(this.outline, this.position);\r\n    }\r\n\r\n    private trimFloatingPetals(): void {\r\n        for (let iP = this.floatingPetals.length - 1; iP >= 0; iP--) {\r\n            const highestPoint = this.floatingPetals[iP].center.y + 0.5 * Math.max(this.floatingPetals[iP].width, this.floatingPetals[iP].height);\r\n            if (highestPoint < 0) {\r\n                this.floatingPetals.splice(iP, 1);\r\n                iP--;\r\n            }\r\n        }\r\n    }\r\n\r\n    private computePetals(nbPetals: number): IPetal[] {\r\n        const result: IPetal[] = [];\r\n\r\n        for (let i = 0; i < nbPetals; i++) {\r\n            const width = Noise.randomInRange(50, 70);\r\n            const proportions = Noise.randomInRange(0.3, 0.7);\r\n            const height = proportions * width;\r\n            const orientation = Noise.randomInRange(0, 2 * Math.PI);\r\n\r\n            result.push({\r\n                width,\r\n                height,\r\n                orientation,\r\n                center: this.position,\r\n                petalArea: width * height,\r\n                rotationSpeed: 0,\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private get petalsDropRate(): number {\r\n        return 0.5 * Parameters.petalsDroprate * 0.1 * this.initialPetalsCount;\r\n    }\r\n\r\n    private static computeOutline(outlineNbPoints: number, outlineRadius: number): IPoint[] {\r\n        const result: IPoint[] = [];\r\n\r\n        for (let i = 0; i < outlineNbPoints; i++) {\r\n            const angle = 2 * Math.PI * i / (outlineNbPoints - 1);\r\n            const radius = outlineRadius * Noise.randomInRange(1, 1.3);\r\n            result.push({\r\n                x: radius * Math.cos(angle),\r\n                y: radius * Math.sin(angle),\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nexport { Corolla };\r\n\r\n","import { Corolla } from \"./corolla\";\r\nimport { ForceField } from \"./force-field\";\r\nimport { IPoint } from \"./interfaces\";\r\nimport { Parameters } from \"./parameters\";\r\nimport { Line, Plotter } from \"./plotting/plotter\";\r\nimport { Rope } from \"./rope\";\r\n\r\n\r\nclass Flower {\r\n    public static readonly maxSegmentLength: number = 20;\r\n\r\n    private readonly attachPoint: IPoint;\r\n    private readonly stem: Rope;\r\n    private readonly corolla: Corolla;\r\n\r\n    public constructor(attachPoint: IPoint, length: number) {\r\n        this.attachPoint = attachPoint;\r\n\r\n        const nbNodes = Math.max(length / Flower.maxSegmentLength);\r\n        this.stem = new Rope(attachPoint, length / nbNodes, nbNodes);\r\n\r\n        this.corolla = new Corolla();\r\n        this.attachCorolla();\r\n    }\r\n\r\n    public update(dt: number, forceField: ForceField): void {\r\n        this.corolla.update(dt);\r\n        const corollaAcceleration = this.corolla.getAcceleration(forceField);\r\n        this.stem.dampening = Parameters.dampening;\r\n        this.stem.update(dt, this.attachPoint, corollaAcceleration);\r\n        this.attachCorolla();\r\n    }\r\n\r\n    public getDrawableStem(): Line {\r\n        return this.stem.getDrawableLine(5);\r\n    }\r\n\r\n    public drawCorolla(plotter: Plotter): void {\r\n        this.corolla.draw(plotter);\r\n    }\r\n\r\n    public isDead(lowestAllowed: number): boolean {\r\n        return this.corolla.isDead(lowestAllowed) && this.stem.highestPoint >= lowestAllowed;\r\n    }\r\n\r\n    private attachCorolla(): void {\r\n        this.corolla.position.x = this.stem.endPosition.x;\r\n        this.corolla.position.y = this.stem.endPosition.y;\r\n    }\r\n}\r\n\r\nexport { Flower };\r\n\r\n","import { Flower } from \"./flower\";\r\nimport { ForceField } from \"./force-field\";\r\nimport { IPoint } from \"./interfaces\";\r\nimport { Noise } from \"./noise\";\r\nimport { Parameters } from \"./parameters\";\r\nimport { Line, Plotter } from \"./plotting/plotter\";\r\n\r\n\r\nclass FlowersManager {\r\n    private readonly flowers: Flower[];\r\n\r\n    public constructor() {\r\n        this.flowers = [];\r\n    }\r\n\r\n    public reset(): void {\r\n        this.flowers.length = 0;\r\n    }\r\n\r\n    public manage(domainWidth: number, domainHeight: number): void {\r\n        let idealNumberOfFlowers = Math.round(domainWidth * Parameters.flowersDensity);\r\n        if (idealNumberOfFlowers <= 0) {\r\n            idealNumberOfFlowers = 1;\r\n        }\r\n\r\n        // create new flowers if needed\r\n        while (this.flowers.length < idealNumberOfFlowers) {\r\n            const newFlower = FlowersManager.createFlower(domainWidth, domainHeight);\r\n            this.flowers.push(newFlower);\r\n        }\r\n\r\n        // handle old flowers\r\n        for (let iF = this.flowers.length - 1; iF >= 0; iF--) {\r\n            if (this.flowers[iF].isDead(domainHeight)) {\r\n                if (this.flowers.length > idealNumberOfFlowers) {\r\n                    // we have too many flowers already, kill old ones\r\n                    this.flowers.splice(iF, 1);\r\n                    iF--;\r\n                } else {\r\n                    // we must maintain this flowers count, recycle old ones\r\n                    this.flowers[iF] = FlowersManager.createFlower(domainWidth, domainHeight);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public update(dt: number, forceField: ForceField): void {\r\n        for (const flower of this.flowers) {\r\n            flower.update(dt, forceField);\r\n        }\r\n    }\r\n\r\n    public draw(plotter: Plotter): void {\r\n        const stems: Line[] = [];\r\n\r\n        for (const flower of this.flowers) {\r\n            stems.push(flower.getDrawableStem());\r\n        }\r\n\r\n        plotter.drawLines(stems);\r\n        for (const flower of this.flowers) {\r\n            flower.drawCorolla(plotter);\r\n        }\r\n    }\r\n\r\n    private static createFlower(domainWidth: number, domainHeight: number): Flower {\r\n        const attachPoint: IPoint = {\r\n            x: domainWidth * Math.random(),\r\n            y: domainHeight,\r\n        };\r\n\r\n        const flowerLength = Noise.randomInRange(0.2, 0.8) * domainHeight;\r\n        return new Flower(attachPoint, flowerLength);\r\n    }\r\n}\r\n\r\nexport { FlowersManager };\r\n\r\n","import { IPoint, IVector } from \"./interfaces\";\r\nimport { Parameters } from \"./parameters\";\r\n\r\n\r\nclass ForceField {\r\n    private readonly fleeMouseEnabled: boolean;\r\n\r\n    public constructor(private readonly mousePosition: IPoint, private readonly maxInfluenceDistance: number) {\r\n        this.fleeMouseEnabled = Parameters.fleeMouse;\r\n    }\r\n\r\n    public computeForce(location: IPoint): IVector {\r\n        if (!this.fleeMouseEnabled) {\r\n            return { x: 0, y: 0 };\r\n        }\r\n\r\n        const fromMouseX = location.x - this.mousePosition.x;\r\n        const fromMouseY = location.y - this.mousePosition.y;\r\n        const distanceToMouse = Math.sqrt(fromMouseX * fromMouseX + fromMouseY * fromMouseY);\r\n\r\n        if (distanceToMouse > this.maxInfluenceDistance) {\r\n            return { x: 0, y: 0 };\r\n        }\r\n\r\n        const mouseInfluence = 0.5 + Math.cos(Math.PI * distanceToMouse / this.maxInfluenceDistance);\r\n        return {\r\n            x: mouseInfluence * mouseInfluence * fromMouseX / distanceToMouse,\r\n            y: mouseInfluence * mouseInfluence * fromMouseY / distanceToMouse,\r\n        };\r\n    }\r\n}\r\n\r\nexport { ForceField };\r\n\r\n","import \"../page-interface-generated\";\r\n\r\nlet gl: WebGLRenderingContext = null;\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(flags?: object): boolean {\r\n    function setError(message: string): void {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    gl = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (gl == null) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (gl == null) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return false;\r\n        }\r\n\r\n        setError(`Your browser or device only supports experimental WebGL.\r\nThe simulation may not run as expected.`);\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    return true;\r\n}\r\n\r\n/* Adjusts the GL canvas size to the actual canvas element size on the page */\r\nfunction adjustSize(hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width !== width || canvas.height !== height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport {\r\n    adjustSize,\r\n    initGL,\r\n    gl,\r\n};\r\n","abstract class GLResource {\r\n    private _gl: WebGLRenderingContext;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        this._gl = gl;\r\n    }\r\n\r\n    public gl(): WebGLRenderingContext {\r\n        return this._gl;\r\n    }\r\n\r\n    public abstract freeGLResources(): void;\r\n}\r\n\r\nexport { GLResource };\r\n","import { gl } from \"./gl-canvas\";\r\nimport { Shader } from \"./shader\";\r\nimport * as ShaderSources from \"./shader-sources\";\r\n\r\ntype RegisterCallback = (success: boolean, shader: Shader | null) => void;\r\n\r\ninterface IShaderInfos {\r\n    fragmentFilename: string;\r\n    vertexFilename: string;\r\n    injected: { [id: string]: string };\r\n}\r\n\r\ninterface ICachedShader {\r\n    shader: Shader | null;\r\n    infos: IShaderInfos;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: RegisterCallback[];\r\n}\r\n\r\nconst cachedShaders: { [id: string]: ICachedShader } = {};\r\n\r\nfunction getShader(name: string): Shader | null {\r\n    return cachedShaders[name].shader;\r\n}\r\n\r\ntype BuildCallback = (builtShader: Shader | null) => void;\r\n\r\nfunction buildShader(infos: IShaderInfos, callback: BuildCallback): void {\r\n    let sourcesPending = 2;\r\n    let sourcesFailed = 0;\r\n\r\n    function loadedSource(success: boolean): void {\r\n        function processSource(source: string): string {\r\n            return source.replace(/#INJECT\\((.*)\\)/mg, (match: string, name: string) => {\r\n                if (infos.injected[name]) {\r\n                    return infos.injected[name];\r\n                }\r\n                return match;\r\n            });\r\n        }\r\n\r\n        sourcesPending--;\r\n        if (!success) {\r\n            sourcesFailed++;\r\n        }\r\n\r\n        if (sourcesPending === 0) {\r\n            let shader = null;\r\n\r\n            if (sourcesFailed === 0) {\r\n                const vert = ShaderSources.getSource(infos.vertexFilename);\r\n                const frag = ShaderSources.getSource(infos.fragmentFilename);\r\n\r\n                const processedVert = processSource(vert);\r\n                const processedFrag = processSource(frag);\r\n\r\n                shader = new Shader(gl, processedVert, processedFrag);\r\n            }\r\n\r\n            callback(shader);\r\n        }\r\n    }\r\n\r\n    ShaderSources.loadSource(infos.vertexFilename, loadedSource);\r\n    ShaderSources.loadSource(infos.fragmentFilename, loadedSource);\r\n}\r\n\r\nfunction registerShader(name: string, infos: IShaderInfos, callback: RegisterCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedShader): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed, cached.shader);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedShaders[name] === \"undefined\") {\r\n        cachedShaders[name] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            infos,\r\n            pending: true,\r\n            shader: null,\r\n        };\r\n        const cached = cachedShaders[name];\r\n\r\n        buildShader(infos, (builtShader: Shader | null) => {\r\n            cached.pending = false;\r\n            cached.failed = builtShader === null;\r\n            cached.shader = builtShader;\r\n\r\n            callAndClearCallbacks(cached);\r\n        });\r\n    } else {\r\n        const cached = cachedShaders[name];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteShader(name: string): void {\r\n    if (typeof cachedShaders[name] !== \"undefined\") {\r\n        if (cachedShaders[name].shader !== null) {\r\n            cachedShaders[name].shader.freeGLResources();\r\n        }\r\n        delete cachedShaders[name];\r\n    }\r\n}\r\n\r\nexport {\r\n    buildShader,\r\n    getShader,\r\n    IShaderInfos,\r\n    registerShader,\r\n    deleteShader,\r\n};\r\n","type LoadCallback = (success: boolean)  => void;\r\n\r\ninterface ICachedSource {\r\n    text: string;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: LoadCallback[];\r\n}\r\n\r\nconst cachedSources: { [id: string]: ICachedSource } = {};\r\n\r\n/* Fetches asynchronously the shader source from server and stores it in cache. */\r\nfunction loadSource(filename: string, callback: LoadCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedSource): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedSources[filename] === \"undefined\") {\r\n        cachedSources[filename] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            pending: true,\r\n            text: null,\r\n        };\r\n        const cached = cachedSources[filename];\r\n\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", \"./shaders/\" + filename, true);\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                cached.pending = false;\r\n\r\n                if (xhr.status === 200) {\r\n                    cached.text = xhr.responseText;\r\n                    cached.failed = false;\r\n                } else {\r\n                    console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n                    cached.failed = true;\r\n                }\r\n\r\n                callAndClearCallbacks(cached);\r\n            }\r\n        };\r\n        xhr.onerror = () => {\r\n            console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n            cached.pending = false;\r\n            cached.failed = true;\r\n            callAndClearCallbacks(cached);\r\n        };\r\n\r\n        xhr.send(null);\r\n    } else {\r\n        const cached = cachedSources[filename];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            cached.callbacks = [callback];\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSource(filename: string): string {\r\n    return cachedSources[filename].text;\r\n}\r\n\r\nexport {\r\n    getSource,\r\n    loadSource,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\nimport { VBO } from \"./vbo\";\r\n\r\nfunction notImplemented(): void {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    } else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    } else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n    gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\ninterface IBindingType {\r\n    str: string;\r\n    binder: (...args: any[]) => unknown;\r\n}\r\nconst types: { [index: string]: IBindingType } = {\r\n    0x8B50: { str: \"FLOAT_VEC2\", binder: bindUniformFloat2v },\r\n    0x8B51: { str: \"FLOAT_VEC3\", binder: bindUniformFloat3v },\r\n    0x8B52: { str: \"FLOAT_VEC4\", binder: bindUniformFloat4v },\r\n    0x8B53: { str: \"INT_VEC2\", binder: bindUniformInt2v },\r\n    0x8B54: { str: \"INT_VEC3\", binder: bindUniformInt3v },\r\n    0x8B55: { str: \"INT_VEC4\", binder: bindUniformInt4v },\r\n    0x8B56: { str: \"BOOL\", binder: bindUniformBool },\r\n    0x8B57: { str: \"BOOL_VEC2\", binder: bindUniformBool2v },\r\n    0x8B58: { str: \"BOOL_VEC3\", binder: bindUniformBool3v },\r\n    0x8B59: { str: \"BOOL_VEC4\", binder: bindUniformBool4v },\r\n    0x8B5A: { str: \"FLOAT_MAT2\", binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: \"FLOAT_MAT3\", binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: \"FLOAT_MAT4\", binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: \"SAMPLER_2D\", binder: bindSampler2D },\r\n    0x8B60: { str: \"SAMPLER_CUBE\", binder: bindSamplerCube },\r\n    0x1400: { str: \"BYTE\", binder: notImplemented },\r\n    0x1401: { str: \"UNSIGNED_BYTE\", binder: notImplemented },\r\n    0x1402: { str: \"SHORT\", binder: notImplemented },\r\n    0x1403: { str: \"UNSIGNED_SHORT\", binder: notImplemented },\r\n    0x1404: { str: \"INT\", binder: bindUniformInt },\r\n    0x1405: { str: \"UNSIGNED_INT\", binder: notImplemented },\r\n    0x1406: { str: \"FLOAT\", binder: bindUniformFloat },\r\n};\r\n\r\ninterface IShaderUniform {\r\n    value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n    loc: WebGLUniformLocation;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\ninterface IShaderAttribute {\r\n    VBO: VBO;\r\n    loc: GLint;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n    public u: { [name: string]: IShaderUniform };\r\n    public a: { [name: string]: IShaderAttribute };\r\n\r\n    private id: WebGLProgram;\r\n    private uCount: number;\r\n    private aCount: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n        function createShader(type: GLenum, source: string): WebGLShader {\r\n            const shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n\r\n            const compileSuccess = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!compileSuccess) {\r\n                console.error(gl.getShaderInfoLog(shader));\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n\r\n            return shader;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        this.id = null;\r\n        this.uCount = 0;\r\n        this.aCount = 0;\r\n\r\n        const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n        const id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n\r\n        const linkSuccess = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!linkSuccess) {\r\n            console.error(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        } else {\r\n            this.id = id;\r\n\r\n            this.introspection();\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteProgram(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public use(): void {\r\n        super.gl().useProgram(this.id);\r\n    }\r\n\r\n    public bindUniforms(): void {\r\n        const gl: WebGLRenderingContext = super.gl();\r\n        let currTextureUnitNb: number = 0;\r\n\r\n        Object.keys(this.u).forEach((uName: string) => {\r\n            const uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    const unitNb: number = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                } else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        Object.keys(this.a).forEach((aName: string) => {\r\n            const attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindUniformsAndAttributes(): void {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    }\r\n\r\n    private introspection(): void {\r\n        const gl = super.gl();\r\n\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = {};\r\n        for (let i = 0; i < this.uCount; i++) {\r\n            const uniform = gl.getActiveUniform(this.id, i);\r\n            const name = uniform.name;\r\n\r\n            this.u[name] = {\r\n                loc: gl.getUniformLocation(this.id, name),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n                value: null,\r\n            };\r\n        }\r\n\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = {};\r\n        for (let i = 0; i < this.aCount; i++) {\r\n            const attribute = gl.getActiveAttrib(this.id, i);\r\n            const name = attribute.name;\r\n\r\n            this.a[name] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport { ShaderProgram as Shader };\r\n","function downloadTextFile(fileName: string, content: string): void {\r\n    const fileType = \"text/plain\";\r\n\r\n    const blob = new Blob([content], { type: fileType });\r\n\r\n    if (typeof window.navigator !== \"undefined\" && typeof (window.navigator as any).msSaveBlob !== \"undefined\") { // for IE\r\n        (window.navigator as any).msSaveBlob(blob, fileName);\r\n    } else {\r\n        const objectUrl = URL.createObjectURL(blob);\r\n\r\n        const linkElement = document.createElement('a');\r\n        linkElement.download = fileName;\r\n        linkElement.href = objectUrl;\r\n        linkElement.dataset.downloadurl = `${fileType}:${linkElement.download}:${linkElement.href}`;\r\n        linkElement.style.display = \"none\";\r\n        document.body.appendChild(linkElement);\r\n        linkElement.click();\r\n        document.body.removeChild(linkElement);\r\n\r\n        // don't forget to free the objectURL after a few seconds\r\n        setTimeout(() => {\r\n            URL.revokeObjectURL(objectUrl);\r\n        }, 5000);\r\n    }\r\n}\r\n\r\nexport { downloadTextFile };\r\n","import { IVector } from \"./interfaces\";\r\n\r\nclass Noise {\r\n    private readonly period: number;\r\n    private time: number;\r\n\r\n    public last: IVector;\r\n    public next: IVector;\r\n\r\n    public constructor(period: number) {\r\n        this.period = period;\r\n        this.time = 0;\r\n        this.last = { x: 0, y: 0 };\r\n        this.next = { x: 0, y: 0 };\r\n\r\n        this.last = Noise.randomVector();\r\n        this.next = Noise.randomVector();\r\n    }\r\n\r\n    public compute(dt: number): IVector {\r\n        this.time += dt;\r\n        if (this.time > this.period) {\r\n            this.last = this.next;\r\n            this.next = Noise.randomVector();\r\n            this.time = this.time % this.period;\r\n        }\r\n\r\n        const r = this.time / this.period;\r\n        return {\r\n            x: this.last.x * (1 - r) + this.next.x * r,\r\n            y: this.last.y * (1 - r) + this.next.y * r,\r\n        };\r\n    }\r\n\r\n    public static randomInRange(from: number, to: number): number {\r\n        return from + (to - from) * Math.random();\r\n    }\r\n\r\n    private static randomVector(): IVector {\r\n        return { x: Math.random(), y: Math.random() };\r\n    }\r\n}\r\n\r\nexport { Noise };\r\n","import { IPoint } from \"./interfaces\";\r\nimport { Color } from \"./plotting/color\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\n\r\n/* === IDs ============================================================ */\r\nconst controlId = {\r\n    FLOWERS_RANGE: \"flowers-range-id\",\r\n    PETALS_COUNT_RANGE: \"petals-count-range-id\",\r\n    PETALS_DROPRATE_CHANGE: \"petals-droprate-range-id\",\r\n    WIND_RANGE: \"wind-range-id\",\r\n    SPEED_RANGE: \"speed-range-id\",\r\n    DAMPENING_RANGE: \"dampening-range-id\",\r\n    FLEE_MOUSE_CHECKBOX: \"flee-mouse-checkbox-id\",\r\n    RESET_BUTTON: \"reset-button-id\",\r\n    BACKGROUND_COLORPICKER: \"background-color-id\",\r\n    LINES_COLORPICKER: \"lines-color-id\",\r\n    PETALS_OPACITY: \"petals-opacity-range-id\",\r\n    SINGLE_PETAL_COLOR_CHECKBOX: \"single-petal-color-checkbox-id\",\r\n    PETAL_COLORPICKER: \"petal-color-id\",\r\n    DOWNLOAD_BUTTON: \"download-button-id\",\r\n};\r\n\r\n/* === OBSERVERS ====================================================== */\r\ntype Observer = () => unknown;\r\nfunction callObservers(observers: Observer[]) {\r\n    for (const observer of observers) {\r\n        observer();\r\n    }\r\n}\r\n\r\nconst resetObservers: Observer[] = [];\r\nconst downloadObservers: Observer[] = [];\r\n\r\nfunction callResetObservers(): void {\r\n    callObservers(resetObservers);\r\n}\r\n\r\nfunction getColor(id: string): Color {\r\n    const rgb = Page.ColorPicker.getValue(id);\r\n    return new Color(rgb.r, rgb.g, rgb.b);\r\n}\r\n\r\nlet backgroundColor: Color = getColor(controlId.BACKGROUND_COLORPICKER);\r\nPage.ColorPicker.addObserver(controlId.BACKGROUND_COLORPICKER, () => { backgroundColor = getColor(controlId.BACKGROUND_COLORPICKER); });\r\n\r\nlet linesColor: Color = getColor(controlId.LINES_COLORPICKER);\r\nPage.ColorPicker.addObserver(controlId.LINES_COLORPICKER, () => { linesColor = getColor(controlId.LINES_COLORPICKER); });\r\n\r\nlet petalsColor: Color = getColor(controlId.PETAL_COLORPICKER);\r\nPage.ColorPicker.addObserver(controlId.PETAL_COLORPICKER, () => { petalsColor = getColor(controlId.PETAL_COLORPICKER); });\r\n\r\n/* === INTERFACE ====================================================== */\r\nclass Parameters {\r\n    public static get mousePositionInPixels(): IPoint {\r\n        const mousePosition = Page.Canvas.getMousePosition();\r\n        if (mousePosition.length === 2) {\r\n            const canvasSize = Page.Canvas.getSize();\r\n            return {\r\n                x: canvasSize[0] * mousePosition[0],\r\n                y: canvasSize[1] * mousePosition[1],\r\n            };\r\n        } else {\r\n            // handles a bug where mousePosition is empty when the page is initializing\r\n            return { x: 0, y: 0 };\r\n        }\r\n    }\r\n\r\n    public static get flowersDensity(): number {\r\n        return Page.Range.getValue(controlId.FLOWERS_RANGE) * 0.25;\r\n    }\r\n\r\n    public static get petalsCount(): number {\r\n        return Page.Range.getValue(controlId.PETALS_COUNT_RANGE);\r\n    }\r\n\r\n    public static get petalsDroprate(): number {\r\n        return Page.Range.getValue(controlId.PETALS_DROPRATE_CHANGE);\r\n    }\r\n\r\n    public static get wind(): number {\r\n        return Page.Range.getValue(controlId.WIND_RANGE);\r\n    }\r\n\r\n    public static get speed(): number {\r\n        return Page.Range.getValue(controlId.SPEED_RANGE);\r\n    }\r\n\r\n    public static get dampening(): number {\r\n        return 1 - 0.01 * Page.Range.getValue(controlId.DAMPENING_RANGE);\r\n    }\r\n\r\n    public static get fleeMouse(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.FLEE_MOUSE_CHECKBOX);\r\n    }\r\n\r\n    public static addResetObserver(observer: Observer): void {\r\n        resetObservers.push(observer);\r\n    }\r\n\r\n    public static get backgroundColor(): Color {\r\n        return backgroundColor;\r\n    }\r\n\r\n    public static get linesColor(): Color {\r\n        return linesColor;\r\n    }\r\n\r\n    public static get petalsOpacity(): number {\r\n        return Page.Range.getValue(controlId.PETALS_OPACITY);\r\n    }\r\n\r\n    public static get singlePetalColor(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.SINGLE_PETAL_COLOR_CHECKBOX);\r\n    }\r\n\r\n    public static get petalColor(): Color {\r\n        return petalsColor;\r\n    }\r\n\r\n    public static addDownloadObserver(observer: Observer): void {\r\n        downloadObservers.push(observer);\r\n    }\r\n\r\n    public static get useCanvas2D(): boolean {\r\n        const lowercaseUrl = window.location.href.toLowerCase();\r\n        return lowercaseUrl.indexOf(\"plotter=canvas2d\") >= 0;\r\n    }\r\n\r\n    private constructor() { }\r\n}\r\n\r\nfunction updatePetalColorsVisibility(): void {\r\n    const visible = Page.Checkbox.isChecked(controlId.SINGLE_PETAL_COLOR_CHECKBOX);\r\n    Page.Controls.setVisibility(controlId.PETAL_COLORPICKER, visible);\r\n}\r\nPage.Checkbox.addObserver(controlId.SINGLE_PETAL_COLOR_CHECKBOX, updatePetalColorsVisibility);\r\nupdatePetalColorsVisibility();\r\n\r\nPage.Button.addObserver(controlId.RESET_BUTTON, callResetObservers);\r\nPage.Range.addLazyObserver(controlId.PETALS_COUNT_RANGE, callResetObservers);\r\nPage.Canvas.Observers.canvasResize.push(callResetObservers);\r\n\r\nPage.FileControl.addDownloadObserver(controlId.DOWNLOAD_BUTTON, () => {\r\n    callObservers(downloadObservers);\r\n});\r\n\r\nexport {\r\n    Parameters,\r\n};\r\n\r\n","class Color {\r\n    public readonly r: number; // integer in [0,255]\r\n    public readonly g: number; // integer in [0,255]\r\n    public readonly b: number; // integer in [0,255]\r\n\r\n    public readonly rNormalized: number; // in [0,1]\r\n    public readonly gNormalized: number; // in [0,1]\r\n    public readonly bNormalized: number; // in [0,1]\r\n\r\n    public constructor(r: number, g: number, b: number) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n\r\n        this.rNormalized = r /255;\r\n        this.gNormalized = g /255;\r\n        this.bNormalized = b /255;\r\n    }\r\n\r\n    public toStringRGB(): string {\r\n        return `rgb(${this.r}, ${this.g}, ${this.b})`;\r\n    }\r\n\r\n    /**\r\n     * @param alpha in [0, 1]\r\n     */\r\n    public toStringRGBA(alpha: number): string {\r\n        return `rgba(${this.r}, ${this.g}, ${this.b}, ${alpha})`;\r\n    }\r\n}\r\n\r\nexport { Color };\r\n","import { IEllipse, IPoint } from \"../interfaces\";\r\nimport { Color } from \"./color\";\r\nimport { Line } from \"./plotter\";\r\nimport { PlotterCanvas } from \"./plotter-canvas-base\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\nfunction ellipsePolyfill(this: CanvasRenderingContext2D, centerX: number, centerY: number, radiusX: number, radiusY: number) {\r\n    this.arc(centerX, centerY, Math.max(radiusX, radiusY), 0, 2 * Math.PI);\r\n}\r\n\r\nclass PlotterCanvas2D extends PlotterCanvas {\r\n    private readonly context: CanvasRenderingContext2D;\r\n\r\n    public constructor() {\r\n        super();\r\n        this.context = this.canvas.getContext(\"2d\", { alpha: false });\r\n        this.context.lineWidth = 1; // do not adapt with cssPixel for performance reasons on mobile devices\r\n    }\r\n\r\n    protected initializeInternal(): void {\r\n        this.context.fillStyle = this.fillColor.toStringRGB();\r\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n\r\n    // tslint:disable-next-line no-empty\r\n    public finalize(): void { }\r\n\r\n    public drawLines(lines: Line[]): void {\r\n        if (lines.length >= 1) {\r\n            this.context.strokeStyle = this.lineColor.toStringRGB();\r\n            this.context.lineWidth = 1; // do not adapt with cssPixel for performance reasons on mobile devices\r\n\r\n            this.context.beginPath();\r\n\r\n            for (const line of lines) {\r\n                if (line.length >= 2) {\r\n                    this.context.moveTo(line[0].x * this.cssPixel, line[0].y * this.cssPixel);\r\n                    for (let iP = 1; iP < line.length; iP++) {\r\n                        this.context.lineTo(line[iP].x * this.cssPixel, line[iP].y * this.cssPixel);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.context.stroke();\r\n            this.context.closePath();\r\n        }\r\n    }\r\n\r\n    public drawPolygon(polygon: Line, offset: IPoint): void {\r\n        if (polygon.length >= 2) {\r\n            this.context.fillStyle = this.fillColor.toStringRGB();\r\n            this.context.lineWidth = 1; // do not adapt with cssPixel for performance reasons on mobile devices\r\n\r\n            this.context.beginPath();\r\n\r\n            this.context.moveTo((polygon[0].x + offset.x) * this.cssPixel, (polygon[0].y + offset.y) * this.cssPixel);\r\n\r\n            for (let iP = 1; iP < polygon.length; iP++) {\r\n                this.context.lineTo((polygon[iP].x + offset.x) * this.cssPixel, (polygon[iP].y + offset.y) * this.cssPixel);\r\n            }\r\n\r\n            this.context.closePath();\r\n            this.context.fill();\r\n            this.context.stroke();\r\n        }\r\n    }\r\n\r\n    public drawEllipses(ellipses: IEllipse[], color: Color): void {\r\n        this.context.fillStyle = color.toStringRGBA(this.ellipseOpacity);\r\n\r\n        if (typeof this.context.ellipse !== \"function\") {\r\n            this.context.ellipse = ellipsePolyfill;\r\n        }\r\n\r\n        for (const ellipse of ellipses) {\r\n            this.context.beginPath();\r\n            this.context.ellipse(ellipse.center.x * this.cssPixel, ellipse.center.y * this.cssPixel, 0.5 * ellipse.width * this.cssPixel, 0.5 * ellipse.height * this.cssPixel, ellipse.orientation, 0, 2 * Math.PI);\r\n            this.context.fill();\r\n            this.context.closePath();\r\n        }\r\n    }\r\n}\r\n\r\nexport {\r\n    PlotterCanvas2D,\r\n};\r\n\r\n","import { Plotter } from \"./plotter\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\nabstract class PlotterCanvas extends Plotter {\r\n    protected readonly canvas: HTMLCanvasElement;\r\n    protected readonly cssPixel: number;\r\n\r\n    public _width: number;\r\n    public _height: number;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        this.canvas = Page.Canvas.getCanvas();\r\n        this.cssPixel = window.devicePixelRatio ?? 1;\r\n        this.adjustToCanvas();\r\n    }\r\n\r\n    public adjustToCanvas(): void {\r\n        const actualWidth = Math.floor(this.cssPixel * this.canvas.clientWidth);\r\n        const actualHeight = Math.floor(this.cssPixel * this.canvas.clientHeight);\r\n\r\n        if (this.canvas.width !== actualWidth || this.canvas.height !== actualHeight) {\r\n            this.canvas.width = actualWidth;\r\n            this.canvas.height = actualHeight;\r\n        }\r\n\r\n        this._width = this.canvas.clientWidth;\r\n        this._height = this.canvas.clientHeight;\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n}\r\n\r\nexport {\r\n    PlotterCanvas,\r\n};\r\n\r\n","import { gl, initGL } from \"../gl-utils/gl-canvas\";\r\nimport { Shader } from \"../gl-utils/shader\";\r\nimport * as ShaderManager from \"../gl-utils/shader-manager\";\r\n\r\nimport { IEllipse, IPoint } from \"../interfaces\";\r\nimport { Color } from \"./color\";\r\nimport { Line } from \"./plotter\";\r\nimport { PlotterCanvas } from \"./plotter-canvas-base\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\nenum EBatchType {\r\n    LINES,\r\n    POLYGONS,\r\n    ELLIPSES,\r\n}\r\n\r\ninterface IBatch {\r\n    type: EBatchType;\r\n    batchId: number;\r\n}\r\n\r\ninterface ILinesBatch extends IBatch {\r\n    type: EBatchType.LINES;\r\n    lines: Line[];\r\n    nbSegments: number;\r\n}\r\n\r\ninterface IEllipsesBatch extends IBatch {\r\n    type: EBatchType.ELLIPSES;\r\n    ellipsesList: IEllipse[];\r\n    color: Color;\r\n}\r\n\r\ninterface IPolygonsBatch extends IBatch {\r\n    outline: IPoint[];\r\n    center: IPoint;\r\n}\r\n\r\nfunction loadShader(name: string, callback: (loadedShader: Shader) => unknown): void {\r\n    ShaderManager.buildShader({\r\n        vertexFilename: `${name}.vert`,\r\n        fragmentFilename: `${name}.frag`,\r\n        injected: {},\r\n    }, (builtShader: Shader | null) => {\r\n        if (builtShader === null) {\r\n            const errorMessage = `Failed to load or build the ${name} shader.`;\r\n            Page.Demopage.setErrorMessage(`shader-${name}`, errorMessage);\r\n            throw new Error(errorMessage);\r\n        }\r\n        callback(builtShader);\r\n    });\r\n}\r\n\r\n/* tslint:disable no-string-literal */\r\nclass PlotterCanvasWebGL extends PlotterCanvas {\r\n    private linesShader: Shader;\r\n    private readonly linesVBOId: WebGLBuffer;\r\n\r\n    private ellipsesShader: Shader;\r\n    private readonly ellipsesVBOId: WebGLBuffer;\r\n\r\n    private polygonsShader: Shader;\r\n    private readonly corollaVBOId: WebGLBuffer;\r\n    private readonly corollaIndexVBOId: WebGLBuffer;\r\n\r\n    private batches: IBatch[];\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        if (!initGL()) {\r\n            throw new Error(\"Failed to initialize WebGL.\");\r\n        }\r\n        gl.enable(gl.BLEND);\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n        gl.depthFunc(gl.LEQUAL);\r\n        gl.clearDepth(1);\r\n\r\n        this.linesVBOId = gl.createBuffer();\r\n        this.ellipsesVBOId = gl.createBuffer();\r\n        this.corollaVBOId = gl.createBuffer();\r\n        this.corollaIndexVBOId = gl.createBuffer();\r\n\r\n        loadShader(\"lines\", (shader: Shader) => { this.linesShader = shader; });\r\n        loadShader(\"ellipses\", (shader: Shader) => { this.ellipsesShader = shader; });\r\n        loadShader(\"polygons\", (shader: Shader) => { this.polygonsShader = shader; });\r\n    }\r\n\r\n    public initializeInternal(): void {\r\n        gl.viewport(0, 0, this.width * this.cssPixel, this.height * this.cssPixel);\r\n        gl.clearColor(this.fillColor.rNormalized, this.fillColor.gNormalized, this.fillColor.bNormalized, 1);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // tslint:disable-line no-bitwise\r\n\r\n        this.batches = [];\r\n    }\r\n\r\n    // tslint:disable-next-line no-empty\r\n    public finalize(): void {\r\n        const linesBatch: ILinesBatch[] = [];\r\n        const polygonsBatch: IPolygonsBatch[] = [];\r\n        const ellipsesBatch: IEllipsesBatch[] = [];\r\n\r\n        for (const batch of this.batches) {\r\n            if (batch.type === EBatchType.LINES) {\r\n                linesBatch.push(batch as ILinesBatch);\r\n            } else if (batch.type === EBatchType.POLYGONS) {\r\n                polygonsBatch.push(batch as IPolygonsBatch);\r\n            } else if (batch.type === EBatchType.ELLIPSES) {\r\n                ellipsesBatch.push(batch as IEllipsesBatch);\r\n            }\r\n        }\r\n\r\n        if (linesBatch.length > 0) {\r\n            this.drawLinesBatches(linesBatch);\r\n        }\r\n\r\n        gl.depthMask(true); // write to depth buffer\r\n        if (polygonsBatch.length > 0) {\r\n            this.drawPolygonsBatches(polygonsBatch);\r\n        }\r\n\r\n        gl.depthMask(false); // don't write to depth buffer because ellipses are not opaque\r\n        if (ellipsesBatch.length > 0) {\r\n            this.drawEllipseBatches(ellipsesBatch);\r\n        }\r\n        this.batches = [];\r\n    }\r\n\r\n    public drawLines(lines: Line[]): void {\r\n        const nonTrivalLines: Line[] = [];\r\n\r\n        let nbSegments = 0;\r\n        for (const line of lines) {\r\n            if (line.length >= 2) {\r\n                nbSegments += line.length - 1;\r\n                nonTrivalLines.push(line);\r\n            }\r\n        }\r\n\r\n        if (nonTrivalLines.length > 0) {\r\n            const linesBatch: ILinesBatch = {\r\n                type: EBatchType.LINES,\r\n                lines: nonTrivalLines,\r\n                nbSegments,\r\n                batchId: this.batches.length,\r\n            };\r\n\r\n            this.batches.push(linesBatch);\r\n        }\r\n    }\r\n\r\n    public drawPolygon(polygon: Line, offset: IPoint): void {\r\n        if (polygon.length > 0) {\r\n            const outline: IPoint[] = [];\r\n            for (const point of polygon) {\r\n                outline.push({\r\n                    x: point.x + offset.x,\r\n                    y: point.y + offset.y,\r\n                });\r\n            }\r\n\r\n            const polygonBatch: IPolygonsBatch = {\r\n                type: EBatchType.POLYGONS,\r\n                outline,\r\n                center: offset,\r\n                batchId: this.batches.length,\r\n            };\r\n            this.batches.push(polygonBatch);\r\n        }\r\n    }\r\n\r\n    public drawEllipses(ellipses: IEllipse[], color: Color): void {\r\n        if (ellipses.length > 0) {\r\n            const ellipsesBatch: IEllipsesBatch = {\r\n                type: EBatchType.ELLIPSES,\r\n                ellipsesList: ellipses,\r\n                color,\r\n                batchId: this.batches.length,\r\n            };\r\n            this.batches.push(ellipsesBatch);\r\n        }\r\n    }\r\n\r\n    private drawLinesBatches(batches: ILinesBatch[]) {\r\n        if (this.linesShader) {\r\n            let totalNbSegments = 0;\r\n            for (const batch of batches) {\r\n                totalNbSegments += batch.nbSegments;\r\n            }\r\n\r\n            const buffer = new Float32Array(2 * 2 * totalNbSegments);\r\n            {\r\n                let i = 0;\r\n                for (const batch of batches) {\r\n                    for (const line of batch.lines) {\r\n                        buffer[i++] = line[0].x;\r\n                        buffer[i++] = line[0].y;\r\n\r\n                        for (let iP = 1; iP < line.length - 1; iP++) {\r\n                            buffer[i++] = line[iP].x;\r\n                            buffer[i++] = line[iP].y;\r\n                            buffer[i++] = line[iP].x;\r\n                            buffer[i++] = line[iP].y;\r\n                        }\r\n\r\n                        buffer[i++] = line[line.length - 1].x;\r\n                        buffer[i++] = line[line.length - 1].y;\r\n                    }\r\n                }\r\n            }\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.linesVBOId);\r\n            gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.DYNAMIC_DRAW);\r\n\r\n            this.linesShader.u[\"uScreenSize\"].value = [this.width, this.height];\r\n            this.linesShader.u[\"uColor\"].value = [this.lineColor.rNormalized, this.lineColor.gNormalized, this.lineColor.bNormalized, 1];\r\n\r\n            this.linesShader.use();\r\n            const aVertexLoc = this.linesShader.a[\"aVertex\"].loc;\r\n            gl.enableVertexAttribArray(aVertexLoc);\r\n\r\n            const FLOAT_SIZE_IN_BYTES = 4;\r\n            let batchStartIndex = 0;\r\n            for (const batch of batches) {\r\n                this.linesShader.u[\"uDepth\"].value = this.computeBatchDepth(batch);\r\n                this.linesShader.bindUniforms();\r\n                gl.vertexAttribPointer(aVertexLoc, 2, gl.FLOAT, false, 0, 2 * batchStartIndex * FLOAT_SIZE_IN_BYTES);\r\n                const nbVertices = 2 * batch.nbSegments;\r\n                gl.drawArrays(gl.LINES, 0, nbVertices);\r\n                batchStartIndex += nbVertices;\r\n            }\r\n        }\r\n    }\r\n\r\n    private drawPolygonsBatches(batches: IPolygonsBatch[]): void {\r\n        if (this.polygonsShader) {\r\n            let totalNbVertices = 0;\r\n            let totalNbTriangles = 0;\r\n            let totalNbLines = 0;\r\n            for (const polygon of batches) {\r\n                totalNbVertices += 1 + polygon.outline.length;\r\n                totalNbTriangles += polygon.outline.length;\r\n                totalNbLines += polygon.outline.length;\r\n            }\r\n\r\n            const verticesBuffer = new Float32Array(4 * totalNbVertices);\r\n            {\r\n                let iVertice = 0;\r\n                for (const polygon of batches) {\r\n                    const polygonDepth = this.computeBatchDepth(polygon);\r\n                    verticesBuffer[iVertice++] = polygon.center.x;\r\n                    verticesBuffer[iVertice++] = polygon.center.y;\r\n                    verticesBuffer[iVertice++] = polygonDepth;\r\n                    verticesBuffer[iVertice++] = 0; // padding for alignment\r\n\r\n                    for (const outlinePoint of polygon.outline) {\r\n                        verticesBuffer[iVertice++] = outlinePoint.x;\r\n                        verticesBuffer[iVertice++] = outlinePoint.y;\r\n                        verticesBuffer[iVertice++] = polygonDepth;\r\n                        verticesBuffer[iVertice++] = 0; // padding for alignment\r\n                    }\r\n                }\r\n            }\r\n\r\n            const indicesBuffer = new Uint16Array(2 * totalNbLines + 3 * totalNbTriangles);\r\n            {\r\n                let iIndex = 0;\r\n                let iVerticeIndex = 0;\r\n                for (const polygon of batches) {\r\n                    const indexOfPolygonCenter = iVerticeIndex;\r\n\r\n                    for (let iPoint = 0; iPoint < polygon.outline.length - 1; iPoint++) {\r\n                        indicesBuffer[iIndex++] = indexOfPolygonCenter;\r\n                        indicesBuffer[iIndex++] = indexOfPolygonCenter + iPoint + 1;\r\n                        indicesBuffer[iIndex++] = indexOfPolygonCenter + iPoint + 2;\r\n                    }\r\n                    indicesBuffer[iIndex++] = indexOfPolygonCenter;\r\n                    indicesBuffer[iIndex++] = indexOfPolygonCenter + polygon.outline.length;\r\n                    indicesBuffer[iIndex++] = indexOfPolygonCenter + 1;\r\n\r\n                    iVerticeIndex += polygon.outline.length + 1;\r\n                }\r\n\r\n                iVerticeIndex = 0;\r\n                for (const polygon of batches) {\r\n                    for (let iPoint = 0; iPoint < polygon.outline.length - 1; iPoint++) {\r\n                        indicesBuffer[iIndex++] = iVerticeIndex + iPoint + 1;\r\n                        indicesBuffer[iIndex++] = iVerticeIndex + iPoint + 2;\r\n                    }\r\n                    indicesBuffer[iIndex++] = iVerticeIndex + polygon.outline.length;\r\n                    indicesBuffer[iIndex++] = iVerticeIndex + 1;\r\n\r\n                    iVerticeIndex += polygon.outline.length + 1;\r\n                }\r\n            }\r\n\r\n            this.polygonsShader.u[\"uScreenSize\"].value = [this.width, this.height];\r\n\r\n            this.polygonsShader.use();\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.corollaVBOId);\r\n            gl.bufferData(gl.ARRAY_BUFFER, verticesBuffer, gl.DYNAMIC_DRAW);\r\n            const aDataLoc = this.polygonsShader.a[\"aData\"].loc;\r\n            gl.enableVertexAttribArray(aDataLoc);\r\n            gl.vertexAttribPointer(aDataLoc, 4, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.corollaIndexVBOId);\r\n            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indicesBuffer, gl.DYNAMIC_DRAW);\r\n\r\n            this.polygonsShader.u[\"uColor\"].value = [this.fillColor.rNormalized, this.fillColor.gNormalized, this.fillColor.bNormalized, 1];\r\n            this.polygonsShader.bindUniforms();\r\n            gl.drawElements(gl.TRIANGLES, 3 * totalNbTriangles, gl.UNSIGNED_SHORT, 0);\r\n\r\n            this.polygonsShader.u[\"uColor\"].value = [this.lineColor.rNormalized, this.lineColor.gNormalized, this.lineColor.bNormalized, 2];\r\n            this.polygonsShader.bindUniforms();\r\n            const UNSIGNED_SHORT_SIZE_IN_BYTES = 2;\r\n            gl.drawElements(gl.LINES, 2 * totalNbLines, gl.UNSIGNED_SHORT, 3 * totalNbTriangles * UNSIGNED_SHORT_SIZE_IN_BYTES);\r\n        }\r\n    }\r\n\r\n    private drawEllipseBatches(batches: IEllipsesBatch[]): void {\r\n        if (this.ellipsesShader) {\r\n            let totalNbPoints = 0;\r\n            for (const ellipseBatch of batches) {\r\n                totalNbPoints += ellipseBatch.ellipsesList.length;\r\n            }\r\n\r\n            const buffer = new Float32Array(8 * totalNbPoints);\r\n            {\r\n                let i = 0;\r\n                for (const ellipseBatch of batches) {\r\n                    const batchDepth = this.computeBatchDepth(ellipseBatch);\r\n\r\n                    for (const ellipse of ellipseBatch.ellipsesList) {\r\n                        const widestSide = Math.ceil(Math.max(1, ellipse.width, ellipse.height)); // integer\r\n                        const proportions = Math.min(ellipse.width, ellipse.height) / widestSide; // in [0, 1]\r\n                        const encodedDimensions = Math.ceil(widestSide * this.cssPixel) + proportions;\r\n\r\n                        buffer[i++] = ellipse.center.x;\r\n                        buffer[i++] = ellipse.center.y;\r\n                        buffer[i++] = encodedDimensions;\r\n                        buffer[i++] = batchDepth;\r\n\r\n                        buffer[i++] = ellipseBatch.color.rNormalized;\r\n                        buffer[i++] = ellipseBatch.color.gNormalized;\r\n                        buffer[i++] = ellipseBatch.color.bNormalized;\r\n                        buffer[i++] = ellipse.orientation;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.ellipsesShader.u[\"uScreenSize\"].value = [this.width, this.height];\r\n            this.ellipsesShader.u[\"uPetalAlpha\"].value = this.ellipseOpacity;\r\n\r\n            this.ellipsesShader.use();\r\n            this.ellipsesShader.bindUniforms();\r\n\r\n            // gl.depthMask(false); // don't write to depth buffer\r\n\r\n            const BYTES_PER_FLOAT = 4;\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.ellipsesVBOId);\r\n            gl.bufferData(gl.ARRAY_BUFFER, buffer, gl.DYNAMIC_DRAW);\r\n            const aData1Loc = this.ellipsesShader.a[\"aData1\"].loc;\r\n            gl.enableVertexAttribArray(aData1Loc);\r\n            gl.vertexAttribPointer(aData1Loc, 4, gl.FLOAT, false, 2 * 4 * BYTES_PER_FLOAT, 0);\r\n            const aData2Loc = this.ellipsesShader.a[\"aData2\"].loc;\r\n            gl.enableVertexAttribArray(aData2Loc);\r\n            gl.vertexAttribPointer(aData2Loc, 4, gl.FLOAT, false, 2 * 4 * BYTES_PER_FLOAT, 4 * BYTES_PER_FLOAT);\r\n            gl.drawArrays(gl.POINTS, 0, totalNbPoints);\r\n        }\r\n    }\r\n\r\n    private computeBatchDepth(batch: IBatch): number {\r\n        return 1.9 * (0.5 - (batch.batchId / this.batches.length));\r\n    }\r\n}\r\n\r\nexport {\r\n    PlotterCanvasWebGL,\r\n};\r\n\r\n","import { IEllipse, IPoint } from \"../interfaces\";\r\nimport { Color } from \"./color\";\r\nimport { Line, Plotter } from \"./plotter\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\nfunction radianToDegree(radian: number) {\r\n    return 180 * radian / Math.PI;\r\n}\r\n\r\nclass PlotterSvg extends Plotter {\r\n    private readonly stringParts: string[];\r\n    private readonly width: number;\r\n    private readonly height: number;\r\n\r\n    public constructor(width: number, height: number) {\r\n        super();\r\n        this.stringParts = [];\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    protected initializeInternal(): void {\r\n        this.stringParts.push(`<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>`);\r\n        this.stringParts.push(`<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewBox=\"0 0 ${this.width} ${this.height}\">`);\r\n\r\n        this.stringParts.push(`\\t<rect fill=\"${this.fillColor.toStringRGB()}\" stroke=\"none\" x=\"0\" y=\"0\" width=\"${this.width}\" height=\"${this.height}\"/>`);\r\n        this.stringParts.push(`\\t<g fill=\"${this.fillColor.toStringRGB()}\" stroke=\"${this.lineColor.toStringRGB()}\" stroke-width=\"1\">`);\r\n    }\r\n\r\n    public finalize(): void {\r\n        this.stringParts.push(\"\\t</g>\");\r\n        this.stringParts.push(\"</svg>\");\r\n    }\r\n\r\n    public toString(): string {\r\n        return this.stringParts.join(\"\\n\");\r\n    }\r\n\r\n    public drawLines(lines: Line[]): void {\r\n        if (lines.length >= 1) {\r\n            this.stringParts.push(`\\t\\t<g fill=\"none\">`);\r\n\r\n            for (const line of lines) {\r\n                if (line.length >= 2) {\r\n                    this.stringParts.push(`\\t\\t\\t<path d=\"${PlotterSvg.computePath(line)}\"/>`);\r\n                }\r\n            }\r\n\r\n            this.stringParts.push(`\\t\\t</g>`);\r\n        }\r\n    }\r\n\r\n    public drawPolygon(polygon: Line, offset: IPoint): void {\r\n        if (polygon.length >= 2) {\r\n            const transform = `translate(${offset.x.toFixed(1)} ${offset.y.toFixed(1)})`;\r\n            this.stringParts.push(`\\t\\t<path d=\"${PlotterSvg.computePath(polygon)}Z\" transform=\"${transform}\"/>`);\r\n        }\r\n    }\r\n\r\n    public drawEllipses(ellipses: IEllipse[], color: Color): void {\r\n        if (ellipses.length >= 1) {\r\n            this.stringParts.push(`\\t\\t<g stroke=\"none\" fill=\"${color.toStringRGBA(this.ellipseOpacity)}\">`);\r\n            for (const ellipse of ellipses) {\r\n                const transform = `translate(${ellipse.center.x.toFixed(1)} ${ellipse.center.y.toFixed(1)}) rotate(${radianToDegree(ellipse.orientation).toFixed(1)})`;\r\n                this.stringParts.push(`\\t\\t\\t<ellipse cx=\"0\" cy=\"0\" rx=\"${(0.5 * ellipse.width).toFixed(1)}\" ry=\"${(0.5 * ellipse.height).toFixed(1)}\" transform=\"${transform}\"/>`);\r\n            }\r\n            this.stringParts.push(`\\t\\t</g>`);\r\n        }\r\n    }\r\n\r\n    private static computePath(line: Line): string {\r\n        const start = `M${line[0].x.toFixed(1)},${line[0].y.toFixed(1)}L`;\r\n\r\n        const pathParts: string[] = [];\r\n        for (let iP = 1; iP < line.length; iP++) {\r\n            pathParts.push(`${line[iP].x.toFixed(1)},${line[iP].y.toFixed(1)}`);\r\n        }\r\n\r\n        return start + pathParts.join(\" \");\r\n    }\r\n}\r\n\r\nexport { PlotterSvg };\r\n\r\n","import { IEllipse, IPoint } from \"../interfaces\";\r\nimport { Color } from \"./color\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\ntype Line = IPoint[];\r\n\r\nabstract class Plotter {\r\n    protected fillColor: Color;\r\n    protected lineColor: Color;\r\n    protected ellipseOpacity: number; // in [0,1]\r\n\r\n    public initialize(fillColor: Color, lineColor: Color, ellipseOpacity: number): void {\r\n        this.fillColor = fillColor;\r\n        this.lineColor = lineColor;\r\n        this.ellipseOpacity = ellipseOpacity;\r\n        this.initializeInternal();\r\n    }\r\n\r\n    protected abstract initializeInternal(): void;\r\n\r\n    public abstract finalize(): void;\r\n\r\n    public abstract drawLines(lines: Line[]): void;\r\n\r\n    public abstract drawPolygon(polygon: Line, offset: IPoint): void;\r\n\r\n    public abstract drawEllipses(ellipses: IEllipse[], color: Color): void;\r\n}\r\n\r\nexport {\r\n    Line,\r\n    Plotter,\r\n};\r\n\r\n","import { IPoint, IVector } from \"./interfaces\";\r\nimport { Line } from \"./plotting/plotter\";\r\n\r\ninterface IRopeNode {\r\n    pos: IPoint;\r\n    previousPos: IPoint;\r\n    acc: IVector;\r\n}\r\n\r\nfunction createRopeNode(x: number, y: number): IRopeNode {\r\n    return {\r\n        pos: { x, y },\r\n        previousPos: { x, y },\r\n        acc: { x: 0, y: 0 },\r\n    };\r\n}\r\n\r\nconst NB_ITERATIONS = 8;\r\n\r\nclass Rope {\r\n    public dampening: number = 1;\r\n\r\n    private readonly nodes: IRopeNode[];\r\n    private readonly segmentLength: number;\r\n    private readonly totalLength: number;\r\n\r\n    public constructor(startingPoint: IPoint, segmentLength: number, nbNodes: number) {\r\n        this.segmentLength = segmentLength;\r\n        this.totalLength = segmentLength * nbNodes;\r\n\r\n        this.nodes = [];\r\n        this.nodes.push(createRopeNode(startingPoint.x, startingPoint.y));\r\n        for (let iN = 0; iN < nbNodes; iN++) {\r\n            const angle = 2 * Math.PI * Math.random();\r\n            this.nodes.push(createRopeNode(\r\n                this.nodes[this.nodes.length - 1].pos.x + segmentLength * Math.cos(angle),\r\n                this.nodes[this.nodes.length - 1].pos.y + Math.abs(segmentLength * Math.sin(angle))\r\n            ));\r\n        }\r\n    }\r\n\r\n    public getDrawableLine(minSegmentLength: number): Line {\r\n        return this.computeSmoothLine(this.totalLength / minSegmentLength);\r\n    }\r\n\r\n    public update(dt: number, origin: IPoint, endAcceleration: IVector): void {\r\n        this.applyForces(endAcceleration);\r\n        this.applyVerlet(dt);\r\n\r\n        for (let i = 0; i < NB_ITERATIONS; i++) {\r\n            this.applyConstraints(origin);\r\n        }\r\n    }\r\n\r\n    public get endPosition(): IPoint {\r\n        return this.nodes[this.nodes.length - 1].pos;\r\n    }\r\n\r\n    public get highestPoint(): number {\r\n        let highest = 1000000;\r\n        for (const node of this.nodes) {\r\n            if (node.pos.y < highest) {\r\n                highest = node.pos.y;\r\n            }\r\n        }\r\n        return highest;\r\n    }\r\n\r\n    private applyForces(endAcceleration: IVector): void {\r\n        for (let iN = 1; iN < this.nodes.length; iN++) {\r\n            this.nodes[iN].acc.x = 0;\r\n            this.nodes[iN].acc.y = 0;\r\n        }\r\n\r\n        this.nodes[this.nodes.length - 1].acc.x += endAcceleration.x;\r\n        this.nodes[this.nodes.length - 1].acc.y += endAcceleration.y;\r\n    }\r\n\r\n    private applyVerlet(dt: number): void {\r\n        for (const node of this.nodes) {\r\n            // CURRENT_VELOCITY = (CURRENT_POSITION - PREVIOUS_POSITION) / DT\r\n            // NEW_VELOCITY = DAMPENING * CURRENT_VELOCITY + CURRENT_ACCELERATION * DT\r\n            // NEW_POSITION = CURRENT_POSITION + NEW_VELOCITY * DT\r\n\r\n            const newPosX = node.pos.x + this.dampening * (node.pos.x - node.previousPos.x) + dt * dt * node.acc.x;\r\n            const newPosY = node.pos.y + this.dampening * (node.pos.y - node.previousPos.y) + dt * dt * node.acc.y;\r\n\r\n            node.previousPos.x = node.pos.x;\r\n            node.previousPos.y = node.pos.y;\r\n            node.pos.x = newPosX;\r\n            node.pos.y = newPosY;\r\n        }\r\n    }\r\n\r\n    private applyConstraints(origin: IPoint): void {\r\n        const EPSILON = 0.000001;\r\n        this.nodes[0].pos.x = origin.x;\r\n        this.nodes[0].pos.y = origin.y;\r\n\r\n        for (let iN = 1; iN < this.nodes.length; iN++) {\r\n            const dX = this.nodes[iN].pos.x - this.nodes[iN - 1].pos.x;\r\n            const dY = this.nodes[iN].pos.y - this.nodes[iN - 1].pos.y;\r\n            const distanceToPrevious = Math.sqrt(dX * dX + dY * dY);\r\n            const correction = 0.5 * (1 - this.segmentLength / (distanceToPrevious + EPSILON));\r\n            const correctionX = dX * correction;\r\n            const correctionY = dY * correction;\r\n\r\n            this.nodes[iN].pos.x -= correctionX;\r\n            this.nodes[iN].pos.y -= correctionY;\r\n            this.nodes[iN - 1].pos.x += correctionX;\r\n            this.nodes[iN - 1].pos.y += correctionY;\r\n        }\r\n    }\r\n\r\n    private computeSmoothLine(minimumPoints: number): IPoint[] {\r\n        let points: IPoint[] = [];\r\n        for (const node of this.nodes) {\r\n            points.push(node.pos);\r\n        }\r\n\r\n        while (points.length < minimumPoints) {\r\n            points = Rope.subdivideLine(points, 0.333);\r\n        }\r\n        return points;\r\n    }\r\n\r\n    // Chaikin\r\n    private static subdivideLine(sourcePoints: IPoint[], ratio: number): IPoint[] {\r\n        const newPoints: IPoint[] = [];\r\n        newPoints.push(sourcePoints[0]);\r\n\r\n        for (let iP = 0; iP < sourcePoints.length - 1; iP++) {\r\n            newPoints.push({\r\n                x: sourcePoints[iP].x * (1 - ratio) + sourcePoints[iP + 1].x * ratio,\r\n                y: sourcePoints[iP].y * (1 - ratio) + sourcePoints[iP + 1].y * ratio,\r\n            });\r\n            newPoints.push({\r\n                x: sourcePoints[iP].x * ratio + sourcePoints[iP + 1].x * (1 - ratio),\r\n                y: sourcePoints[iP].y * ratio + sourcePoints[iP + 1].y * (1 - ratio),\r\n            });\r\n        }\r\n\r\n        newPoints.push(sourcePoints[sourcePoints.length - 1]);\r\n        return newPoints;\r\n    }\r\n}\r\n\r\nexport { Rope };\r\n\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { FlowersManager } from \"./flowers-manager\";\r\nimport { ForceField } from \"./force-field\";\r\nimport { downloadTextFile } from \"./helpers\";\r\nimport { Parameters } from \"./parameters\";\r\n\r\nimport { Plotter } from \"./plotting/plotter\";\r\nimport { PlotterCanvas2D } from \"./plotting/plotter-canvas-2d\";\r\nimport { PlotterCanvas } from \"./plotting/plotter-canvas-base\";\r\nimport { PlotterCanvasWebGL } from \"./plotting/plotter-canvas-webgl\";\r\nimport { PlotterSvg } from \"./plotting/plotter-svg\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\n\r\nfunction plot(flowersManager: FlowersManager, plotter: Plotter): void {\r\n    plotter.initialize(Parameters.backgroundColor, Parameters.linesColor, Parameters.petalsOpacity);\r\n    flowersManager.draw(plotter);\r\n    plotter.finalize();\r\n}\r\n\r\nfunction main() {\r\n    const plotter: PlotterCanvas = Parameters.useCanvas2D ? new PlotterCanvas2D() : new PlotterCanvasWebGL();\r\n    const flowersManager = new FlowersManager();\r\n\r\n    Parameters.addResetObserver(() => { flowersManager.reset(); });\r\n    Parameters.addDownloadObserver(() => { exportAsSvg(flowersManager, plotter.width, plotter.height); });\r\n\r\n    const maxDt = 1 / 60;\r\n    let lastUpdate = performance.now();\r\n    function mainLoop() {\r\n        const now = performance.now();\r\n        const dt = Parameters.speed * Math.min(maxDt, 0.001 * (now - lastUpdate));\r\n        lastUpdate = now;\r\n\r\n        plotter.adjustToCanvas();\r\n\r\n        flowersManager.manage(plotter.width, plotter.height);\r\n\r\n        const forceField = new ForceField(Parameters.mousePositionInPixels, 500);\r\n        flowersManager.update(dt, forceField);\r\n\r\n        plot(flowersManager, plotter);\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n\r\n    requestAnimationFrame(mainLoop);\r\n}\r\n\r\nfunction exportAsSvg(flowersManager: FlowersManager, width: number, height: number): void {\r\n    const plotter = new PlotterSvg(width, height);\r\n    plot(flowersManager, plotter);\r\n\r\n    const svgText = plotter.toString();\r\n    downloadTextFile(\"flowers.svg\", svgText);\r\n}\r\n\r\nmain();\r\n"],"names":["random","randomChannel","this","position","x","y","color","Noise","randomInRange","Math","floor","Color","initialPetalsCount","Parameters","petalsCount","attachedPetals","computePetals","floatingPetals","outline","Corolla","computeOutline","noise","maxLiftingForce","update","dt","length","petalsDropRate","detachedPetal","pop","center","rotationSpeed","push","petalArea","orientation","trimFloatingPetals","wind","compute","draw","plotter","drawOutline","drawPetals","getAcceleration","forceField","strength","pow","acceleration","fieldForce","computeForce","isDead","lowestAllowed","allPetals","concat","singlePetalColor","petalColor","drawEllipses","drawPolygon","iP","max","width","height","splice","nbPetals","result","i","PI","petalsDroprate","outlineNbPoints","outlineRadius","angle","radius","cos","sin","attachPoint","nbNodes","Flower","maxSegmentLength","stem","Rope","corolla","attachCorolla","corollaAcceleration","dampening","getDrawableStem","getDrawableLine","drawCorolla","highestPoint","endPosition","flowers","reset","manage","domainWidth","domainHeight","idealNumberOfFlowers","round","flowersDensity","newFlower","FlowersManager","createFlower","iF","stems","flower","drawLines","flowerLength","mousePosition","maxInfluenceDistance","fleeMouseEnabled","fleeMouse","location","fromMouseX","fromMouseY","distanceToMouse","sqrt","mouseInfluence","ForceField","gl","initGL","flags","setError","message","Page","Demopage","setErrorMessage","canvas","Canvas","getCanvas","getContext","disable","CULL_FACE","DEPTH_TEST","BLEND","clearColor","adjustSize","hidpi","cssPixel","window","devicePixelRatio","clientWidth","clientHeight","_gl","GLResource","cachedShaders","buildShader","infos","callback","sourcesPending","sourcesFailed","loadedSource","success","processSource","source","replace","match","name","injected","shader","vert","ShaderSources","getSource","vertexFilename","frag","fragmentFilename","processedVert","processedFrag","Shader","loadSource","getShader","registerShader","callAndClearCallbacks","cached","callbacks","cachedCallback","failed","pending","builtShader","deleteShader","freeGLResources","cachedSources","filename","text","XMLHttpRequest","open","onload","readyState","status","responseText","console","error","statusText","onerror","send","notImplemented","alert","types","str","binder","value","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","Array","isArray","uniform1iv","uniform1fv","uniform1f","vertexSource","fragmentSource","createShader","type","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","id","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","use","useProgram","bindUniforms","currTextureUnitNb","Object","keys","u","forEach","uName","uniform","loc","bindAttributes","a","aName","attribute","VBO","bind","bindUniformsAndAttributes","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","size","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","downloadTextFile","fileName","content","fileType","blob","Blob","navigator","msSaveBlob","URL","createObjectURL","linkElement","document","createElement","download","href","dataset","downloadurl","style","display","body","appendChild","click","removeChild","setTimeout","revokeObjectURL","period","time","last","next","randomVector","r","from","to","controlId","FLOWERS_RANGE","PETALS_COUNT_RANGE","PETALS_DROPRATE_CHANGE","WIND_RANGE","SPEED_RANGE","DAMPENING_RANGE","FLEE_MOUSE_CHECKBOX","RESET_BUTTON","BACKGROUND_COLORPICKER","LINES_COLORPICKER","PETALS_OPACITY","SINGLE_PETAL_COLOR_CHECKBOX","PETAL_COLORPICKER","DOWNLOAD_BUTTON","callObservers","observers","observer","resetObservers","downloadObservers","callResetObservers","getColor","rgb","ColorPicker","getValue","g","b","backgroundColor","addObserver","linesColor","petalsColor","getMousePosition","canvasSize","getSize","Range","Checkbox","isChecked","addResetObserver","addDownloadObserver","toLowerCase","indexOf","updatePetalColorsVisibility","visible","Controls","setVisibility","Button","addLazyObserver","Observers","canvasResize","FileControl","rNormalized","gNormalized","bNormalized","toStringRGB","toStringRGBA","alpha","ellipsePolyfill","centerX","centerY","radiusX","radiusY","arc","context","lineWidth","initializeInternal","fillStyle","fillColor","fillRect","finalize","lines","strokeStyle","lineColor","beginPath","line","moveTo","lineTo","stroke","closePath","polygon","offset","fill","ellipses","ellipseOpacity","ellipse","PlotterCanvas","PlotterCanvas2D","adjustToCanvas","actualWidth","actualHeight","_width","_height","Plotter","EBatchType","loadShader","ShaderManager","errorMessage","Error","enable","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","depthFunc","LEQUAL","clearDepth","linesVBOId","createBuffer","ellipsesVBOId","corollaVBOId","corollaIndexVBOId","linesShader","ellipsesShader","polygonsShader","viewport","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","batches","linesBatch","polygonsBatch","ellipsesBatch","batch","LINES","POLYGONS","ELLIPSES","drawLinesBatches","depthMask","drawPolygonsBatches","drawEllipseBatches","nonTrivalLines","nbSegments","batchId","point","polygonBatch","ellipsesList","totalNbSegments","buffer","Float32Array","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","aVertexLoc","enableVertexAttribArray","batchStartIndex","computeBatchDepth","vertexAttribPointer","FLOAT","nbVertices","drawArrays","totalNbVertices","totalNbTriangles","totalNbLines","verticesBuffer","iVertice","polygonDepth","outlinePoint","indicesBuffer","Uint16Array","iIndex","iVerticeIndex","indexOfPolygonCenter","iPoint","aDataLoc","ELEMENT_ARRAY_BUFFER","drawElements","TRIANGLES","UNSIGNED_SHORT","totalNbPoints","ellipseBatch","batchDepth","widestSide","ceil","proportions","min","encodedDimensions","aData1Loc","aData2Loc","POINTS","PlotterCanvasWebGL","stringParts","toString","join","PlotterSvg","computePath","transform","toFixed","radian","start","pathParts","initialize","createRopeNode","pos","previousPos","acc","startingPoint","segmentLength","totalLength","nodes","iN","abs","minSegmentLength","computeSmoothLine","origin","endAcceleration","applyForces","applyVerlet","applyConstraints","highest","node","newPosX","newPosY","dX","dY","distanceToPrevious","correction","correctionX","correctionY","minimumPoints","points","subdivideLine","sourcePoints","ratio","newPoints","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","plot","flowersManager","petalsOpacity","useCanvas2D","svgText","exportAsSvg","lastUpdate","performance","now","requestAnimationFrame","mainLoop","speed","mousePositionInPixels","main"],"sourceRoot":""}