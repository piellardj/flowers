!function(){"use strict";var t={652:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.Corolla=void 0;var o=n(26),r=n(61),i=n(40),a=function(){function t(){var e,n;this.position={x:0,y:0},this.color=(e=o.Noise.randomInRange(0,3),n=Math.floor(e%1*127.5),e<1?new i.Color(255,0,255-n):e<2?new i.Color(255,n,0):e<3?new i.Color(255-n,255,0):e<4?new i.Color(0,255,n):e<5?new i.Color(0,255-n,255):new i.Color(n,0,255)),this.initialPetalsCount=r.Parameters.petalsCount,this.attachedPetals=this.computePetals(this.initialPetalsCount),this.floatingPetals=[],this.outline=t.computeOutline(40,20),this.noise=new o.Noise(o.Noise.randomInRange(1,2)),this.maxLiftingForce=o.Noise.randomInRange(5e3,8e3)}return t.prototype.update=function(t){this.attachedPetals.length>0&&Math.random()<this.petalsDropRate*t&&((i=this.attachedPetals.pop()).center={x:this.position.x,y:this.position.y},i.rotationSpeed=o.Noise.randomInRange(-1.5,1.5),this.floatingPetals.push(i));for(var e=0,n=this.floatingPetals;e<n.length;e++){var i;(i=n[e]).center.y-=.05*i.petalArea*t,i.orientation+=i.rotationSpeed*t}this.trimFloatingPetals(),this.wind=this.noise.compute(t),this.wind.x=1e4*r.Parameters.wind*(this.wind.x-.5),this.wind.y=1e3*(this.wind.y-.5)},t.prototype.draw=function(t){this.drawOutline(t),this.drawPetals(t)},t.prototype.getAcceleration=function(t){var e=.75;this.initialPetalsCount>0&&(e=Math.pow(this.attachedPetals.length/this.initialPetalsCount,.25));var n={x:0,y:0};n.x+=this.wind.x*e,n.y+=this.wind.y,n.y+=3e3-this.maxLiftingForce*e;var o=t.computeForce(this.position);return n.x+=2e3*e*o.x,n.y+=2e3*e*o.y,n},t.prototype.isDead=function(t){return r.Parameters.petalsCount>0&&this.attachedPetals.length<=0&&this.floatingPetals.length<=0&&this.position.y>t+50},t.prototype.drawPetals=function(t){var e=this.attachedPetals.concat(this.floatingPetals),n=r.Parameters.singlePetalColor?r.Parameters.petalColor:this.color;t.drawEllipses(e,n)},t.prototype.drawOutline=function(t){t.drawPolygon(this.outline,this.position)},t.prototype.trimFloatingPetals=function(){for(var t=this.floatingPetals.length-1;t>=0;t--)this.floatingPetals[t].center.y+.5*Math.max(this.floatingPetals[t].width,this.floatingPetals[t].height)<0&&(this.floatingPetals.splice(t,1),t--)},t.prototype.computePetals=function(t){for(var e=[],n=0;n<t;n++){var r=o.Noise.randomInRange(50,70),i=o.Noise.randomInRange(.3,.7)*r,a=o.Noise.randomInRange(0,2*Math.PI);e.push({width:r,height:i,orientation:a,center:this.position,petalArea:r*i,rotationSpeed:0})}return e},Object.defineProperty(t.prototype,"petalsDropRate",{get:function(){return.5*r.Parameters.petalsDroprate*.1*this.initialPetalsCount},enumerable:!1,configurable:!0}),t.computeOutline=function(t,e){for(var n=[],r=0;r<t;r++){var i=2*Math.PI*r/(t-1),a=e*o.Noise.randomInRange(1,1.3);n.push({x:a*Math.cos(i),y:a*Math.sin(i)})}return n},t}();e.Corolla=a},481:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.Flower=void 0;var o=n(652),r=n(61),i=n(661),a=function(){function t(e,n){this.attachPoint=e;var r=Math.max(n/t.maxSegmentLength);this.stem=new i.Rope(e,n/r,r),this.corolla=new o.Corolla,this.attachCorolla()}return t.prototype.update=function(t,e){this.corolla.update(t);var n=this.corolla.getAcceleration(e);this.stem.dampening=r.Parameters.dampening,this.stem.update(t,this.attachPoint,n),this.attachCorolla()},t.prototype.getDrawableStem=function(){return this.stem.getDrawableLine(5)},t.prototype.drawCorolla=function(t){this.corolla.draw(t)},t.prototype.isDead=function(t){return this.corolla.isDead(t)&&this.stem.highestPoint>=t},t.prototype.attachCorolla=function(){this.corolla.position.x=this.stem.endPosition.x,this.corolla.position.y=this.stem.endPosition.y},t.maxSegmentLength=20,t}();e.Flower=a},410:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.FlowersManager=void 0;var o=n(481),r=n(26),i=n(61),a=function(){function t(){this.flowers=[]}return t.prototype.reset=function(){this.flowers.length=0},t.prototype.manage=function(e,n){var o=Math.round(e*i.Parameters.flowersDensity);for(o<=0&&(o=1);this.flowers.length<o;){var r=t.createFlower(e,n);this.flowers.push(r)}for(var a=this.flowers.length-1;a>=0;a--)this.flowers[a].isDead(n)&&(this.flowers.length>o?(this.flowers.splice(a,1),a--):this.flowers[a]=t.createFlower(e,n))},t.prototype.update=function(t,e){for(var n=0,o=this.flowers;n<o.length;n++)o[n].update(t,e)},t.prototype.draw=function(t){for(var e=[],n=0,o=this.flowers;n<o.length;n++){var r=o[n];e.push(r.getDrawableStem())}t.drawLines(e);for(var i=0,a=this.flowers;i<a.length;i++)(r=a[i]).drawCorolla(t)},t.createFlower=function(t,e){var n={x:t*Math.random(),y:e},i=r.Noise.randomInRange(.2,.8)*e;return new o.Flower(n,i)},t}();e.FlowersManager=a},255:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.ForceField=void 0;var o=n(61),r=function(){function t(t,e){this.mousePosition=t,this.maxInfluenceDistance=e,this.fleeMouseEnabled=o.Parameters.fleeMouse}return t.prototype.computeForce=function(t){if(!this.fleeMouseEnabled)return{x:0,y:0};var e=t.x-this.mousePosition.x,n=t.y-this.mousePosition.y,o=Math.sqrt(e*e+n*n);if(o>this.maxInfluenceDistance)return{x:0,y:0};var r=.5+Math.cos(Math.PI*o/this.maxInfluenceDistance);return{x:r*r*e/o,y:r*r*n/o}},t}();e.ForceField=r},753:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.gl=e.initGL=e.adjustSize=void 0,n(457);var o=null;e.gl=o,e.initGL=function(t){function n(t){Page.Demopage.setErrorMessage("webgl-support",t)}var r=Page.Canvas.getCanvas();if(e.gl=o=r.getContext("webgl",t),null==o){if(e.gl=o=r.getContext("experimental-webgl",t),null==o)return n("Your browser or device does not seem to support WebGL."),!1;n("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.BLEND),o.clearColor(0,0,0,1),!0},e.adjustSize=function(t){void 0===t&&(t=!1);var e=t?window.devicePixelRatio:1,n=o.canvas,r=Math.floor(n.clientWidth*e),i=Math.floor(n.clientHeight*e);n.width===r&&n.height===i||(n.width=r,n.height=i)}},771:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.GLResource=void 0;var n=function(){function t(t){this._gl=t}return t.prototype.gl=function(){return this._gl},t}();e.GLResource=n},748:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&o(e,t,n);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.deleteShader=e.registerShader=e.getShader=e.buildShader=void 0;var a=n(753),s=n(490),l=i(n(71)),c={};function h(t,e){var n=2,o=0;function r(r){function i(e){return e.replace(/#INJECT\((.*)\)/gm,(function(e,n){return t.injected[n]?t.injected[n]:e}))}if(n--,r||o++,0===n){var c=null;if(0===o){var h=l.getSource(t.vertexFilename),u=l.getSource(t.fragmentFilename),d=i(h),f=i(u);c=new s.Shader(a.gl,d,f)}e(c)}}l.loadSource(t.vertexFilename,r),l.loadSource(t.fragmentFilename,r)}e.getShader=function(t){return c[t].shader},e.buildShader=h,e.registerShader=function(t,e,n){function o(t){for(var e=0,n=t.callbacks;e<n.length;e++)(0,n[e])(!t.failed,t.shader);t.callbacks=[]}if(void 0===c[t]){c[t]={callbacks:[n],failed:!1,infos:e,pending:!0,shader:null};var r=c[t];h(e,(function(t){r.pending=!1,r.failed=null===t,r.shader=t,o(r)}))}else{var i=c[t];!0===i.pending?i.callbacks.push(n):o(i)}},e.deleteShader=function(t){void 0!==c[t]&&(null!==c[t].shader&&c[t].shader.freeGLResources(),delete c[t])}},71:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.loadSource=e.getSource=void 0;var n={};e.loadSource=function(t,e){function o(t){for(var e=0,n=t.callbacks;e<n.length;e++)(0,n[e])(!t.failed);t.callbacks=[]}if(void 0===n[t]){n[t]={callbacks:[e],failed:!1,pending:!0,text:null};var r=n[t],i=new XMLHttpRequest;i.open("GET","./shaders/"+t,!0),i.onload=function(){4===i.readyState&&(r.pending=!1,200===i.status?(r.text=i.responseText,r.failed=!1):(console.error("Cannot load '".concat(t,"' shader source: ").concat(i.statusText)),r.failed=!0),o(r))},i.onerror=function(){console.error("Cannot load '".concat(t,"' shader source: ").concat(i.statusText)),r.pending=!1,r.failed=!0,o(r)},i.send(null)}else{var a=n[t];!0===a.pending?a.callbacks.push(e):(a.callbacks=[e],o(a))}},e.getSource=function(t){return n[t].text}},490:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=void 0;var i=n(771);function a(){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(t,e,n){t.uniform2fv(e,n)}},35665:{str:"FLOAT_VEC3",binder:function(t,e,n){t.uniform3fv(e,n)}},35666:{str:"FLOAT_VEC4",binder:function(t,e,n){t.uniform4fv(e,n)}},35667:{str:"INT_VEC2",binder:function(t,e,n){t.uniform2iv(e,n)}},35668:{str:"INT_VEC3",binder:function(t,e,n){t.uniform3iv(e,n)}},35669:{str:"INT_VEC4",binder:function(t,e,n){t.uniform4iv(e,n)}},35670:{str:"BOOL",binder:function(t,e,n){t.uniform1i(e,+n)}},35671:{str:"BOOL_VEC2",binder:function(t,e,n){t.uniform2iv(e,n)}},35672:{str:"BOOL_VEC3",binder:function(t,e,n){t.uniform3iv(e,n)}},35673:{str:"BOOL_VEC4",binder:function(t,e,n){t.uniform4iv(e,n)}},35674:{str:"FLOAT_MAT2",binder:function(t,e,n){t.uniformMatrix2fv(e,!1,n)}},35675:{str:"FLOAT_MAT3",binder:function(t,e,n){t.uniformMatrix3fv(e,!1,n)}},35676:{str:"FLOAT_MAT4",binder:function(t,e,n){t.uniformMatrix4fv(e,!1,n)}},35678:{str:"SAMPLER_2D",binder:function(t,e,n,o){t.uniform1i(e,n),t.activeTexture(t["TEXTURE"+n]),t.bindTexture(t.TEXTURE_2D,o)}},35680:{str:"SAMPLER_CUBE",binder:function(t,e,n,o){t.uniform1i(e,n),t.activeTexture(t["TEXTURE"+n]),t.bindTexture(t.TEXTURE_CUBE_MAP,o)}},5120:{str:"BYTE",binder:a},5121:{str:"UNSIGNED_BYTE",binder:a},5122:{str:"SHORT",binder:a},5123:{str:"UNSIGNED_SHORT",binder:a},5124:{str:"INT",binder:function(t,e,n){Array.isArray(n),t.uniform1iv(e,n)}},5125:{str:"UNSIGNED_INT",binder:a},5126:{str:"FLOAT",binder:function(t,e,n){Array.isArray(n)?t.uniform1fv(e,n):t.uniform1f(e,n)}}},l=function(t){function e(e,n,o){var r=this;function i(t,n){var o=e.createShader(t);return e.shaderSource(o,n),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(console.error(e.getShaderInfoLog(o)),e.deleteShader(o),null)}(r=t.call(this,e)||this).id=null,r.uCount=0,r.aCount=0;var a=i(e.VERTEX_SHADER,n),s=i(e.FRAGMENT_SHADER,o),l=e.createProgram();return e.attachShader(l,a),e.attachShader(l,s),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS)?(r.id=l,r.introspection()):(console.error(e.getProgramInfoLog(l)),e.deleteProgram(l)),r}return r(e,t),e.prototype.freeGLResources=function(){t.prototype.gl.call(this).deleteProgram(this.id),this.id=null},e.prototype.use=function(){t.prototype.gl.call(this).useProgram(this.id)},e.prototype.bindUniforms=function(){var e=this,n=t.prototype.gl.call(this),o=0;Object.keys(this.u).forEach((function(t){var r=e.u[t];if(null!==r.value)if(35678===r.type||35680===r.type){var i=o;s[r.type].binder(n,r.loc,i,r.value),o++}else s[r.type].binder(n,r.loc,r.value)}))},e.prototype.bindAttributes=function(){var t=this;Object.keys(this.a).forEach((function(e){var n=t.a[e];null!==n.VBO&&n.VBO.bind(n.loc)}))},e.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},e.prototype.introspection=function(){var e=t.prototype.gl.call(this);this.uCount=e.getProgramParameter(this.id,e.ACTIVE_UNIFORMS),this.u={};for(var n=0;n<this.uCount;n++){var o=e.getActiveUniform(this.id,n),r=o.name;this.u[r]={loc:e.getUniformLocation(this.id,r),size:o.size,type:o.type,value:null}}for(this.aCount=e.getProgramParameter(this.id,e.ACTIVE_ATTRIBUTES),this.a={},n=0;n<this.aCount;n++){var i=e.getActiveAttrib(this.id,n),a=i.name;this.a[a]={VBO:null,loc:e.getAttribLocation(this.id,a),size:i.size,type:i.type}}},e}(i.GLResource);e.Shader=l},747:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.downloadTextFile=void 0,e.downloadTextFile=function(t,e){var n="text/plain",o=new Blob([e],{type:n});if(void 0!==window.navigator&&void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=URL.createObjectURL(o),i=document.createElement("a");i.download=t,i.href=r,i.dataset.downloadurl="".concat(n,":").concat(i.download,":").concat(i.href),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((function(){URL.revokeObjectURL(r)}),5e3)}}},26:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Noise=void 0;var n=function(){function t(e){this.period=e,this.time=0,this.last={x:0,y:0},this.next={x:0,y:0},this.last=t.randomVector(),this.next=t.randomVector()}return t.prototype.compute=function(e){this.time+=e,this.time>this.period&&(this.last=this.next,this.next=t.randomVector(),this.time=this.time%this.period);var n=this.time/this.period;return{x:this.last.x*(1-n)+this.next.x*n,y:this.last.y*(1-n)+this.next.y*n}},t.randomInRange=function(t,e){return t+(e-t)*Math.random()},t.randomVector=function(){return{x:Math.random(),y:Math.random()}},t}();e.Noise=n},457:function(){},61:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.Parameters=void 0;var o=n(40);n(457);var r="petals-count-range-id",i="background-color-id",a="lines-color-id",s="single-petal-color-checkbox-id",l="petal-color-id";function c(t){for(var e=0,n=t;e<n.length;e++)(0,n[e])()}var h=[],u=[];function d(){c(h)}function f(t){var e=Page.ColorPicker.getValue(t);return new o.Color(e.r,e.g,e.b)}var p=f(i);Page.ColorPicker.addObserver(i,(function(){p=f(i)}));var g=f(a);Page.ColorPicker.addObserver(a,(function(){g=f(a)}));var v=f(l);Page.ColorPicker.addObserver(l,(function(){v=f(l)}));var y=function(){function t(){}return Object.defineProperty(t,"mousePositionInPixels",{get:function(){var t=Page.Canvas.getMousePosition();if(2===t.length){var e=Page.Canvas.getSize();return{x:e[0]*t[0],y:e[1]*t[1]}}return{x:0,y:0}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"flowersDensity",{get:function(){return.25*Page.Range.getValue("flowers-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"petalsCount",{get:function(){return Page.Range.getValue(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"petalsDroprate",{get:function(){return Page.Range.getValue("petals-droprate-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"wind",{get:function(){return Page.Range.getValue("wind-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"speed",{get:function(){return Page.Range.getValue("speed-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"dampening",{get:function(){return 1-.01*Page.Range.getValue("dampening-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fleeMouse",{get:function(){return Page.Checkbox.isChecked("flee-mouse-checkbox-id")},enumerable:!1,configurable:!0}),t.addResetObserver=function(t){h.push(t)},Object.defineProperty(t,"backgroundColor",{get:function(){return p},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linesColor",{get:function(){return g},enumerable:!1,configurable:!0}),Object.defineProperty(t,"petalsOpacity",{get:function(){return Page.Range.getValue("petals-opacity-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(t,"singlePetalColor",{get:function(){return Page.Checkbox.isChecked(s)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"petalColor",{get:function(){return v},enumerable:!1,configurable:!0}),t.addDownloadObserver=function(t){u.push(t)},Object.defineProperty(t,"useCanvas2D",{get:function(){return window.location.href.toLowerCase().indexOf("plotter=canvas2d")>=0},enumerable:!1,configurable:!0}),t}();function b(){var t=Page.Checkbox.isChecked(s);Page.Controls.setVisibility(l,t)}e.Parameters=y,Page.Checkbox.addObserver(s,b),b(),Page.Button.addObserver("reset-button-id",d),Page.Range.addLazyObserver(r,d),Page.Canvas.Observers.canvasResize.push(d),Page.FileControl.addDownloadObserver("download-button-id",(function(){c(u)}))},40:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.Color=void 0;var n=function(){function t(t,e,n){this.r=t,this.g=e,this.b=n,this.rNormalized=t/255,this.gNormalized=e/255,this.bNormalized=n/255}return t.prototype.toStringRGB=function(){return"rgb(".concat(this.r,", ").concat(this.g,", ").concat(this.b,")")},t.prototype.toStringRGBA=function(t){return"rgba(".concat(this.r,", ").concat(this.g,", ").concat(this.b,", ").concat(t,")")},t}();e.Color=n},643:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.PlotterCanvas2D=void 0;var i=n(254);function a(t,e,n,o){this.arc(t,e,Math.max(n,o),0,2*Math.PI)}n(457);var s=function(t){function e(){var e=t.call(this)||this;return e.context=e.canvas.getContext("2d",{alpha:!1}),e.context.lineWidth=1,e}return r(e,t),e.prototype.initializeInternal=function(){this.context.fillStyle=this.fillColor.toStringRGB(),this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},e.prototype.finalize=function(){},e.prototype.drawLines=function(t){if(t.length>=1){this.context.strokeStyle=this.lineColor.toStringRGB(),this.context.lineWidth=1,this.context.beginPath();for(var e=0,n=t;e<n.length;e++){var o=n[e];if(o.length>=2){this.context.moveTo(o[0].x*this.cssPixel,o[0].y*this.cssPixel);for(var r=1;r<o.length;r++)this.context.lineTo(o[r].x*this.cssPixel,o[r].y*this.cssPixel)}}this.context.stroke(),this.context.closePath()}},e.prototype.drawPolygon=function(t,e){if(t.length>=2){this.context.fillStyle=this.fillColor.toStringRGB(),this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo((t[0].x+e.x)*this.cssPixel,(t[0].y+e.y)*this.cssPixel);for(var n=1;n<t.length;n++)this.context.lineTo((t[n].x+e.x)*this.cssPixel,(t[n].y+e.y)*this.cssPixel);this.context.closePath(),this.context.fill(),this.context.stroke()}},e.prototype.drawEllipses=function(t,e){this.context.fillStyle=e.toStringRGBA(this.ellipseOpacity),"function"!=typeof this.context.ellipse&&(this.context.ellipse=a);for(var n=0,o=t;n<o.length;n++){var r=o[n];this.context.beginPath(),this.context.ellipse(r.center.x*this.cssPixel,r.center.y*this.cssPixel,.5*r.width*this.cssPixel,.5*r.height*this.cssPixel,r.orientation,0,2*Math.PI),this.context.fill(),this.context.closePath()}},e}(i.PlotterCanvas);e.PlotterCanvas2D=s},254:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.PlotterCanvas=void 0;var i=n(66);n(457);var a=function(t){function e(){var e,n=t.call(this)||this;return n.canvas=Page.Canvas.getCanvas(),n.cssPixel=null!==(e=window.devicePixelRatio)&&void 0!==e?e:1,n.adjustToCanvas(),n}return r(e,t),e.prototype.adjustToCanvas=function(){var t=Math.floor(this.cssPixel*this.canvas.clientWidth),e=Math.floor(this.cssPixel*this.canvas.clientHeight);this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e),this._width=this.canvas.clientWidth,this._height=this.canvas.clientHeight},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}(i.Plotter);e.PlotterCanvas=a},193:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return a(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.PlotterCanvasWebGL=void 0;var l,c=n(753),h=s(n(748)),u=n(254);function d(t,e){h.buildShader({vertexFilename:"".concat(t,".vert"),fragmentFilename:"".concat(t,".frag"),injected:{}},(function(n){if(null===n){var o="Failed to load or build the ".concat(t," shader.");throw Page.Demopage.setErrorMessage("shader-".concat(t),o),new Error(o)}e(n)}))}n(457),function(t){t[t.LINES=0]="LINES",t[t.POLYGONS=1]="POLYGONS",t[t.ELLIPSES=2]="ELLIPSES"}(l||(l={}));var f=function(t){function e(){var e=t.call(this)||this;if(!(0,c.initGL)())throw new Error("Failed to initialize WebGL.");return c.gl.enable(c.gl.BLEND),c.gl.blendFunc(c.gl.SRC_ALPHA,c.gl.ONE_MINUS_SRC_ALPHA),c.gl.enable(c.gl.DEPTH_TEST),c.gl.depthFunc(c.gl.LEQUAL),c.gl.clearDepth(1),e.linesVBOId=c.gl.createBuffer(),e.ellipsesVBOId=c.gl.createBuffer(),e.corollaVBOId=c.gl.createBuffer(),e.corollaIndexVBOId=c.gl.createBuffer(),d("lines",(function(t){e.linesShader=t})),d("ellipses",(function(t){e.ellipsesShader=t})),d("polygons",(function(t){e.polygonsShader=t})),e}return r(e,t),e.prototype.initializeInternal=function(){c.gl.viewport(0,0,this.width*this.cssPixel,this.height*this.cssPixel),c.gl.clearColor(this.fillColor.rNormalized,this.fillColor.gNormalized,this.fillColor.bNormalized,1),c.gl.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT),this.batches=[]},e.prototype.finalize=function(){for(var t=[],e=[],n=[],o=0,r=this.batches;o<r.length;o++){var i=r[o];i.type===l.LINES?t.push(i):i.type===l.POLYGONS?e.push(i):i.type===l.ELLIPSES&&n.push(i)}t.length>0&&this.drawLinesBatches(t),c.gl.depthMask(!0),e.length>0&&this.drawPolygonsBatches(e),c.gl.depthMask(!1),n.length>0&&this.drawEllipseBatches(n),this.batches=[]},e.prototype.drawLines=function(t){for(var e=[],n=0,o=0,r=t;o<r.length;o++){var i=r[o];i.length>=2&&(n+=i.length-1,e.push(i))}if(e.length>0){var a={type:l.LINES,lines:e,nbSegments:n,batchId:this.batches.length};this.batches.push(a)}},e.prototype.drawPolygon=function(t,e){if(t.length>0){for(var n=[],o=0,r=t;o<r.length;o++){var i=r[o];n.push({x:i.x+e.x,y:i.y+e.y})}var a={type:l.POLYGONS,outline:n,center:e,batchId:this.batches.length};this.batches.push(a)}},e.prototype.drawEllipses=function(t,e){if(t.length>0){var n={type:l.ELLIPSES,ellipsesList:t,color:e,batchId:this.batches.length};this.batches.push(n)}},e.prototype.drawLinesBatches=function(t){if(this.linesShader){for(var e=0,n=0,o=t;n<o.length;n++)e+=(y=o[n]).nbSegments;for(var r=new Float32Array(4*e),i=0,a=0,s=t;a<s.length;a++)for(var l=0,h=(y=s[a]).lines;l<h.length;l++){var u=h[l];r[i++]=u[0].x,r[i++]=u[0].y;for(var d=1;d<u.length-1;d++)r[i++]=u[d].x,r[i++]=u[d].y,r[i++]=u[d].x,r[i++]=u[d].y;r[i++]=u[u.length-1].x,r[i++]=u[u.length-1].y}c.gl.bindBuffer(c.gl.ARRAY_BUFFER,this.linesVBOId),c.gl.bufferData(c.gl.ARRAY_BUFFER,r,c.gl.DYNAMIC_DRAW),this.linesShader.u.uScreenSize.value=[this.width,this.height],this.linesShader.u.uColor.value=[this.lineColor.rNormalized,this.lineColor.gNormalized,this.lineColor.bNormalized,1],this.linesShader.use();var f=this.linesShader.a.aVertex.loc;c.gl.enableVertexAttribArray(f);for(var p=0,g=0,v=t;g<v.length;g++){var y=v[g];this.linesShader.u.uDepth.value=this.computeBatchDepth(y),this.linesShader.bindUniforms(),c.gl.vertexAttribPointer(f,2,c.gl.FLOAT,!1,0,2*p*4);var b=2*y.nbSegments;c.gl.drawArrays(c.gl.LINES,0,b),p+=b}}},e.prototype.drawPolygonsBatches=function(t){if(this.polygonsShader){for(var e=0,n=0,o=0,r=0,i=t;r<i.length;r++)e+=1+(u=i[r]).outline.length,n+=u.outline.length,o+=u.outline.length;for(var a=new Float32Array(4*e),s=0,l=0,h=t;l<h.length;l++){var u=h[l],d=this.computeBatchDepth(u);a[s++]=u.center.x,a[s++]=u.center.y,a[s++]=d,a[s++]=0;for(var f=0,p=u.outline;f<p.length;f++){var g=p[f];a[s++]=g.x,a[s++]=g.y,a[s++]=d,a[s++]=0}}for(var v=new Uint16Array(2*o+3*n),y=0,b=0,P=0,m=t;P<m.length;P++){u=m[P];for(var x=b,w=0;w<u.outline.length-1;w++)v[y++]=x,v[y++]=x+w+1,v[y++]=x+w+2;v[y++]=x,v[y++]=x+u.outline.length,v[y++]=x+1,b+=u.outline.length+1}b=0;for(var _=0,O=t;_<O.length;_++){for(u=O[_],w=0;w<u.outline.length-1;w++)v[y++]=b+w+1,v[y++]=b+w+2;v[y++]=b+u.outline.length,v[y++]=b+1,b+=u.outline.length+1}this.polygonsShader.u.uScreenSize.value=[this.width,this.height],this.polygonsShader.use(),c.gl.bindBuffer(c.gl.ARRAY_BUFFER,this.corollaVBOId),c.gl.bufferData(c.gl.ARRAY_BUFFER,a,c.gl.DYNAMIC_DRAW);var S=this.polygonsShader.a.aData.loc;c.gl.enableVertexAttribArray(S),c.gl.vertexAttribPointer(S,4,c.gl.FLOAT,!1,0,0),c.gl.bindBuffer(c.gl.ELEMENT_ARRAY_BUFFER,this.corollaIndexVBOId),c.gl.bufferData(c.gl.ELEMENT_ARRAY_BUFFER,v,c.gl.DYNAMIC_DRAW),this.polygonsShader.u.uColor.value=[this.fillColor.rNormalized,this.fillColor.gNormalized,this.fillColor.bNormalized,1],this.polygonsShader.bindUniforms(),c.gl.drawElements(c.gl.TRIANGLES,3*n,c.gl.UNSIGNED_SHORT,0),this.polygonsShader.u.uColor.value=[this.lineColor.rNormalized,this.lineColor.gNormalized,this.lineColor.bNormalized,2],this.polygonsShader.bindUniforms(),c.gl.drawElements(c.gl.LINES,2*o,c.gl.UNSIGNED_SHORT,3*n*2)}},e.prototype.drawEllipseBatches=function(t){if(this.ellipsesShader){for(var e=0,n=0,o=t;n<o.length;n++)e+=(l=o[n]).ellipsesList.length;for(var r=new Float32Array(8*e),i=0,a=0,s=t;a<s.length;a++)for(var l=s[a],h=this.computeBatchDepth(l),u=0,d=l.ellipsesList;u<d.length;u++){var f=d[u],p=Math.ceil(Math.max(1,f.width,f.height)),g=Math.min(f.width,f.height)/p,v=Math.ceil(p*this.cssPixel)+g;r[i++]=f.center.x,r[i++]=f.center.y,r[i++]=v,r[i++]=h,r[i++]=l.color.rNormalized,r[i++]=l.color.gNormalized,r[i++]=l.color.bNormalized,r[i++]=f.orientation}this.ellipsesShader.u.uScreenSize.value=[this.width,this.height],this.ellipsesShader.u.uPetalAlpha.value=this.ellipseOpacity,this.ellipsesShader.use(),this.ellipsesShader.bindUniforms(),c.gl.bindBuffer(c.gl.ARRAY_BUFFER,this.ellipsesVBOId),c.gl.bufferData(c.gl.ARRAY_BUFFER,r,c.gl.DYNAMIC_DRAW);var y=this.ellipsesShader.a.aData1.loc;c.gl.enableVertexAttribArray(y),c.gl.vertexAttribPointer(y,4,c.gl.FLOAT,!1,32,0);var b=this.ellipsesShader.a.aData2.loc;c.gl.enableVertexAttribArray(b),c.gl.vertexAttribPointer(b,4,c.gl.FLOAT,!1,32,16),c.gl.drawArrays(c.gl.POINTS,0,e)}},e.prototype.computeBatchDepth=function(t){return 1.9*(.5-t.batchId/this.batches.length)},e}(u.PlotterCanvas);e.PlotterCanvasWebGL=f},493:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.PlotterSvg=void 0;var i=n(66);n(457);var a=function(t){function e(e,n){var o=t.call(this)||this;return o.stringParts=[],o.width=e,o.height=n,o}return r(e,t),e.prototype.initializeInternal=function(){this.stringParts.push('<?xml version="1.0" encoding="UTF-8" standalone="no"?>'),this.stringParts.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '.concat(this.width," ").concat(this.height,'">')),this.stringParts.push('\t<rect fill="'.concat(this.fillColor.toStringRGB(),'" stroke="none" x="0" y="0" width="').concat(this.width,'" height="').concat(this.height,'"/>')),this.stringParts.push('\t<g fill="'.concat(this.fillColor.toStringRGB(),'" stroke="').concat(this.lineColor.toStringRGB(),'" stroke-width="1">'))},e.prototype.finalize=function(){this.stringParts.push("\t</g>"),this.stringParts.push("</svg>")},e.prototype.toString=function(){return this.stringParts.join("\n")},e.prototype.drawLines=function(t){if(t.length>=1){this.stringParts.push('\t\t<g fill="none">');for(var n=0,o=t;n<o.length;n++){var r=o[n];r.length>=2&&this.stringParts.push('\t\t\t<path d="'.concat(e.computePath(r),'"/>'))}this.stringParts.push("\t\t</g>")}},e.prototype.drawPolygon=function(t,n){if(t.length>=2){var o="translate(".concat(n.x.toFixed(1)," ").concat(n.y.toFixed(1),")");this.stringParts.push('\t\t<path d="'.concat(e.computePath(t),'Z" transform="').concat(o,'"/>'))}},e.prototype.drawEllipses=function(t,e){if(t.length>=1){this.stringParts.push('\t\t<g stroke="none" fill="'.concat(e.toStringRGBA(this.ellipseOpacity),'">'));for(var n=0,o=t;n<o.length;n++){var r=o[n],i="translate(".concat(r.center.x.toFixed(1)," ").concat(r.center.y.toFixed(1),") rotate(").concat((a=r.orientation,180*a/Math.PI).toFixed(1),")");this.stringParts.push('\t\t\t<ellipse cx="0" cy="0" rx="'.concat((.5*r.width).toFixed(1),'" ry="').concat((.5*r.height).toFixed(1),'" transform="').concat(i,'"/>'))}this.stringParts.push("\t\t</g>")}var a},e.computePath=function(t){for(var e="M".concat(t[0].x.toFixed(1),",").concat(t[0].y.toFixed(1),"L"),n=[],o=1;o<t.length;o++)n.push("".concat(t[o].x.toFixed(1),",").concat(t[o].y.toFixed(1)));return e+n.join(" ")},e}(i.Plotter);e.PlotterSvg=a},66:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.Plotter=void 0,n(457);var o=function(){function t(){}return t.prototype.initialize=function(t,e,n){this.fillColor=t,this.lineColor=e,this.ellipseOpacity=n,this.initializeInternal()},t}();e.Plotter=o},661:function(t,e){function n(t,e){return{pos:{x:t,y:e},previousPos:{x:t,y:e},acc:{x:0,y:0}}}Object.defineProperty(e,"__esModule",{value:!0}),e.Rope=void 0;var o=function(){function t(t,e,o){this.dampening=1,this.segmentLength=e,this.totalLength=e*o,this.nodes=[],this.nodes.push(n(t.x,t.y));for(var r=0;r<o;r++){var i=2*Math.PI*Math.random();this.nodes.push(n(this.nodes[this.nodes.length-1].pos.x+e*Math.cos(i),this.nodes[this.nodes.length-1].pos.y+Math.abs(e*Math.sin(i))))}}return t.prototype.getDrawableLine=function(t){return this.computeSmoothLine(this.totalLength/t)},t.prototype.update=function(t,e,n){this.applyForces(n),this.applyVerlet(t);for(var o=0;o<8;o++)this.applyConstraints(e)},Object.defineProperty(t.prototype,"endPosition",{get:function(){return this.nodes[this.nodes.length-1].pos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highestPoint",{get:function(){for(var t=1e6,e=0,n=this.nodes;e<n.length;e++){var o=n[e];o.pos.y<t&&(t=o.pos.y)}return t},enumerable:!1,configurable:!0}),t.prototype.applyForces=function(t){for(var e=1;e<this.nodes.length;e++)this.nodes[e].acc.x=0,this.nodes[e].acc.y=0;this.nodes[this.nodes.length-1].acc.x+=t.x,this.nodes[this.nodes.length-1].acc.y+=t.y},t.prototype.applyVerlet=function(t){for(var e=0,n=this.nodes;e<n.length;e++){var o=n[e],r=o.pos.x+this.dampening*(o.pos.x-o.previousPos.x)+t*t*o.acc.x,i=o.pos.y+this.dampening*(o.pos.y-o.previousPos.y)+t*t*o.acc.y;o.previousPos.x=o.pos.x,o.previousPos.y=o.pos.y,o.pos.x=r,o.pos.y=i}},t.prototype.applyConstraints=function(t){this.nodes[0].pos.x=t.x,this.nodes[0].pos.y=t.y;for(var e=1;e<this.nodes.length;e++){var n=this.nodes[e].pos.x-this.nodes[e-1].pos.x,o=this.nodes[e].pos.y-this.nodes[e-1].pos.y,r=Math.sqrt(n*n+o*o),i=.5*(1-this.segmentLength/(r+1e-6)),a=n*i,s=o*i;this.nodes[e].pos.x-=a,this.nodes[e].pos.y-=s,this.nodes[e-1].pos.x+=a,this.nodes[e-1].pos.y+=s}},t.prototype.computeSmoothLine=function(e){for(var n=[],o=0,r=this.nodes;o<r.length;o++){var i=r[o];n.push(i.pos)}for(;n.length<e;)n=t.subdivideLine(n,.333);return n},t.subdivideLine=function(t,e){var n=[];n.push(t[0]);for(var o=0;o<t.length-1;o++)n.push({x:t[o].x*(1-e)+t[o+1].x*e,y:t[o].y*(1-e)+t[o+1].y*e}),n.push({x:t[o].x*e+t[o+1].x*(1-e),y:t[o].y*e+t[o+1].y*(1-e)});return n.push(t[t.length-1]),n},t}();e.Rope=o}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}!function(){var t=n(410),e=n(255),o=n(747),r=n(61),i=n(643),a=n(193),s=n(493);function l(t,e){e.initialize(r.Parameters.backgroundColor,r.Parameters.linesColor,r.Parameters.petalsOpacity),t.draw(e),e.finalize()}n(457),function(){var n=r.Parameters.useCanvas2D?new i.PlotterCanvas2D:new a.PlotterCanvasWebGL,c=new t.FlowersManager;r.Parameters.addResetObserver((function(){c.reset()})),r.Parameters.addDownloadObserver((function(){!function(t,e,n){var r=new s.PlotterSvg(e,n);l(t,r);var i=r.toString();(0,o.downloadTextFile)("flowers.svg",i)}(c,n.width,n.height)}));var h=performance.now();requestAnimationFrame((function t(){var o=performance.now(),i=r.Parameters.speed*Math.min(.016666666666666666,.001*(o-h));h=o,n.adjustToCanvas(),c.manage(n.width,n.height);var a=new e.ForceField(r.Parameters.mousePositionInPixels,500);c.update(i,a),l(c,n),requestAnimationFrame(t)}))}()}()}();
//# sourceMappingURL=main.min.js.map